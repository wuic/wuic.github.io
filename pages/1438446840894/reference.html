<!DOCTYPE html> <html manifest="/pages/1438446840894/reference.html.appcache" lang="en"> <head><link rel="preload" href="/pages/2861444051/0000000049DA5EE5aggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1575378833/000000006B8EFF0Daggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1438446842000/bootstrap/css/a/../img/glyphicons-halflings.png" as="image" />
<link rel="preload" href="/pages/1438446842000/bootstrap/css/a/../img/glyphicons-halflings-white.png" as="image" />
<link rel="preload" href="/pages/1438446842000/wiki-css/a/../wiki-images/background.png" as="image" />
<link rel="preload" href="/pages/1438446842184/font-awesome/css/a/../font/fontawesome-webfont.eot" as="font" />
<link rel="preload" href="/pages/1438446842199/font-awesome/css/a/../font/fontawesome-webfont.woff" as="font" />
<link rel="preload" href="/pages/1438446842195/font-awesome/css/a/../font/fontawesome-webfont.ttf" as="font" />
<link rel="preload" href="/pages/1438446842247/000000006B8EFF0Dwiki-images/logo/favicon.ico" as="image" />
<link rel="preload" href="/pages/1043268269/000000004EE7BAAFaggregate.js" as="script" />
 <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.2"> <title>Supported server and known issues</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel="stylesheet" type="text/css" href="/pages/2861444051/0000000049DA5EE5aggregate.css" />
 </head> <body class="article toc2 toc-right"> <div id="header"> <div id="toc" class="toc2"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#_supported_server_and_known_issues">Supported server and known issues</a> <ul class="sectlevel2"> <li><a href="#_unknown_mime_type_in_filter">Unknown MIME type in Filter</a></li> <li><a href="#_best_effort_warmup_polling_and_async_version_computation">Best effort, warmup, polling and async version computation</a></li> </ul> </li> <li><a href="#_error_codes">Error codes</a></li> <li><a href="#_caching_mechanism">Caching mechanism</a> <ul class="sectlevel2"> <li><a href="#_caching_on_server_side">Caching on server side</a></li> <li><a href="#_caching_on_client_side">Caching on client side</a></li> </ul> </li> <li><a href="#_best_effort">Best effort</a></li> <li><a href="#_feature_comparison">Feature comparison</a> <ul class="sectlevel2"> <li><a href="#_choose_the_right_tool">Choose the right tool</a></li> <li><a href="#_features_overview">Features overview</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <link rel="stylesheet" type="text/css" href="/pages/1575378833/000000006B8EFF0Daggregate.css" />
<link rel="shortcut icon" href="/pages/1438446842247/000000006B8EFF0Dwiki-images/logo/favicon.ico" />
    <!--[if lt IE 9]><script src="../assets/js/html5shiv.js"></script><![endif]-->   <div class="masthead"> <div class="navbar"> <div class="navbar-inner"> <div class="container"> <ul class="nav" role="navigation"> <li><a href="index.html"><i class="icon-home"></i><span class="hidden-phone">&nbsp;Home</span></a></li> <li><a href="project.html"><i class="icon-star"></i><span class="hidden-phone">&nbsp;Project</span></a></li> <li class="active"><a href="wuic-documentation.html"><i class="icon-book"></i><span class="hidden-phone">&nbsp;Documentation</span></a></li> <li><a href="contact.html"><i class="icon-envelope"></i><span class="hidden-phone">&nbsp;Contact</span></a></li> <li><a href="https://github.com/wuic/wuic" target="_blank" title="Wuic Github"><i class="icon-github"></i><span class="hidden-phone">&nbsp;Github</span></a></li> <li><a href="https://twitter.com/wuic_project" target="_blank"><i class="icon-twitter"></i><span class="hidden-phone">&nbsp;Twitter</span></a></li> </ul> </div> </div> </div> </div> <div class="sect1"> <h2 id="_supported_server_and_known_issues">Supported server and known issues</h2> <div class="sectionbody"> <div class="paragraph"> <p>WUIC is designed to be deployed in any <code>Servlet 3</code> compatible server running on top of <code>Java 6</code> and above:</p> </div> <div class="ulist"> <ul> <li> <p><code>Jetty</code> since <code>8.0</code></p> </li> <li> <p><code>Tomcat</code> since <code>7.0</code></p> </li> <li> <p><code>GlassFish</code> since <code>3.0</code></p> </li> <li> <p><code>JBoss</code> since <code>6.0</code></p> </li> <li> <p><code>WebLogic</code> since <code>12.0</code></p> </li> <li> <p><code>Undertow</code> since <code>1.0</code></p> </li> </ul> </div> <div class="paragraph"> <p>However, some features have a limited support on some specific version. Known issues are identified with a link to the details and workaround in the table below.</p> </div> <table> <tr> <td><b>Feature/Servlet Container</b></td> <td>Jetty</td> <td>Tomcat</td> <td>GlassFish</td> <td>JBoss</td> <td>WebLogic</td> <td>Undertow (Wildfly)</td> </tr> <tr> <td><a href="#_unknown_mime_type_in_filter">Unknown MIME type in Filter</a></td> <td>OK</td> <td>OK</td> <td>Test needed!</td> <td>Test needed!</td> <td>Test needed!</td> <td>Before 1.1 (Wildfly 8.1)</td> </tr> <tr> <td><a href="#_best_effort_warmup_polling_and_async_version_computation">Best effort, warmup, polling and async version computation</a></td> <td>Since 9.3.0.M2</td> <td>OK</td> <td>Test needed!</td> <td>Test needed!</td> <td>Test needed!</td> <td>Before 1.2</td> </tr> </table> <div class="sect2"> <h3 id="_unknown_mime_type_in_filter">Unknown MIME type in Filter</h3> <div class="paragraph"> <p>Because of <a href="https://issues.jboss.org/browse/UNDERTOW-268">UNDERTOW-268</a> issue, WUIC&#8217;s servlet filter will fails if you deploy it on Undertow 1.0 (which is the default HTTP server in Wildfly 8.0 and 8.1).</p> </div> <div class="paragraph"> <p>A workaround exist: create a filter that force the mime type on resources filtered by WUIC. For instance:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">/**
 * Workaround for https://issues.jboss.org/browse/UNDERTOW-268 issue.
 *
 * @author Guillaume DROUET
 * @since 0.5.0
 * @version 1.0
 */
public class MimeTypeFilter implements Filter {

    /**
     * {@inheritDoc}
     */
    @Override
    public void init(final FilterConfig filterConfig) throws ServletException {
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public void doFilter(final ServletRequest servletRequest,
                         final ServletResponse servletResponse,
                         final FilterChain filterChain)
            throws IOException, ServletException {
        filterChain.doFilter(servletRequest, servletResponse);
        servletResponse.setContentType("text/html");
    }

    /**
     * {@inheritDoc}
     */
    @Override
    public void destroy() {
    }
}</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_best_effort_warmup_polling_and_async_version_computation">Best effort, warmup, polling and async version computation</h3> <div class="paragraph"> <p>When a <code>Nut</code> is created with the <code>RequestDispatcherNutDao</code> component, the path is resolve with the <code>ServletContext#getResource(String)</code> method, which works fine in any servlet container.</p> </div> <div class="paragraph"> <p>However, the content is dynamic (generated by a <code>Servlet</code> or a <code>JSP</code>), you must tell WUIC to use <code>RequestDispatcher#include(HttpServletRequest,HttpServletResponse)</code> thanks to the <code>c.g.wuic.dao.useIncludeForPathPattern</code> that accepts a regex matching the desired path. The problem is that following references explain that any attempt to use a <code>RequestDispatcher</code> outside the HTTP request/response lifecycle and/or in another thread will fail:</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://issues.jboss.org/browse/UNDERTOW-357">UNDERTOW-357 fixed in 1.2</a></p> </li> <li> <p><a href="https://github.com/eclipse/jetty.project/commit/c23f21c761ff56f2ad4841a98083b237494442de#commitcomment-10495706">Optimization in Jetty 9.3 that won&#8217;t be removed</a></p> </li> </ul> </div> <div class="paragraph"> <p>This lead to the following limitations when you use the <code>RequestDispatcherNutDao</code>, which is the default DAO in the <code>HtmlParserFilter</code>:</p> </div> <div class="ulist"> <ul> <li> <p>Warmup strategy must be set to NONE (default setting)</p> </li> <li> <p>Version number must be computed synchronously (done asynchronously by default)</p> </li> <li> <p>Nut polling must be disabled (default setting)</p> </li> <li> <p>Cache engines must disable best effort (default setting)</p> </li> </ul> </div> <div class="paragraph"> <p>Considering those points, you should be ok if you configure your <code>wuic.properties</code> like this when you use <code>RequestDispatcherNutDao</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre>c.g.wuic.computeVersionAsynchronously=false
c.g.wuic.engine.bestEffort=false</pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_error_codes">Error codes</h2> <div class="sectionbody"> <div class="paragraph"> <p>WUIC tries to clearly identify an error with a specific exception and a specific error code. When an exception is thrown, you will see in the logs the code which is described <a href="http://wuic.github.io/apidocs/com/github/wuic/exception/ErrorCode.html">here</a>.</p> </div> <div class="paragraph"> <p>If you have any suggestion about a more detailed code to be provided by WUIC, please <a href="http://wuic.github.io/contact.html">contact</a> us.</p> </div> </div> </div> <div class="sect1"> <h2 id="_caching_mechanism">Caching mechanism</h2> <div class="sectionbody"> <div class="paragraph"> <p>Caching is a critical issue because it is often the most effective way to improve performances. However, implementing a cache mechanism becomes tricky when we want to expose fresh data to the users.</p> </div> <div class="paragraph"> <p>WUIC helps developer to expose statics while taking advantage from caching on both server-side and client-side. It also takes care of cache eviction when statics need to be refreshed. This page introduces how WUIC does the trick.</p> </div> <div class="sect2"> <h3 id="_caching_on_server_side">Caching on server side</h3> <div class="paragraph"> <p>When a workflow is executed on server side, a set of statics are retrieved to be converted to treatable nuts. The result is added to a cache which could be managed behind the scene by a <code>memory map</code> or then <code>EhCache</code> if you configured it.</p> </div> <div class="paragraph"> <p>Then, any other execution of the workflow will be faster because WUIC will use the cache to retrieve processed nuts.</p> </div> <div class="paragraph"> <p>To guarantee nuts freshness, you can obviously configure the cache with some settings to set a time to live or a time to idle. However, this simple solution has its limitation. Once you deployed your new statics, they will be ignored until the cache has expired. Moreover, cache duration becomes a big problem since you may configure a high value (say 1 day) because you want that your application uses the cache as much as possible.</p> </div> <div class="paragraph"> <p>A better solution would be the <a href="tutorials.html#_monitor_changes">polling feature</a>. Here a thread will check any changes on set of statics at a configured interleave. Nothing prevents you to poll your statics more regularly, say every 10 minutes.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> it becomes interesting when you realize that WUIC triggers an event internally to evict the cache entry when any associated nut corresponds to an updated static. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_caching_on_client_side">Caching on client side</h3> <div class="paragraph"> <p>The HTTP protocol provides several directives to order caching to the browser. We often talk about the <a href="http://en.wikipedia.org/wiki/Web_cache#Cache_control">cache control</a> header. The <code>max-age</code> value defines how long the static should be kept before checking for new update. The same problem on the server appears: you don&#8217;t know how long the user will load an old version from browser cache until its expiry. Consequently, you may probably set a short value. When the statics expires, the browser sends an HTTP request to the server to know if the data is fresh or not. If data is fresh, server responds with a status code <code>304 - not modified</code> and an empty body. However, it sends the fresh data in the body. What is unfortunate here is that the browser could poll the server synchronously and, at the end, see that nothing changed. WUIC does not use the cache control for that reason.</p> </div> <div class="paragraph"> <p>The HTTP response should instead contains a "expires" directive which tells the browser to keep the statics for a very long time. Since cache entry is associated the path URL of the static, WUIC has just to modify this path to evict the cache. How it does the trick? By adding in the URL a <code>CRC32</code> hash based on all nuts name processed by the workflow and their last modification timestamp. When nuts are changed, it could be detected on redeployment or during a polling operation. Both cases will result in the computation of a different <code>CRC32</code> hash which will change the static URL, which does not corresponds to any cache entry on the browser. This is the way WUIC prevent any unnecessary HTTP request on the server while maintaining fresh statics loaded by the browser.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> with HTTP/2 <code>server-push</code> is always initiated and stopped as soon as the browser has detected that the resource is actually cached. With <code>resource-hint</code>, the browser will check first that resource is not cached before creating a new HTTP request. </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="_best_effort">Best effort</h2> <div class="sectionbody"> <div class="paragraph"> <p>By default at runtime, any cache <code>Engine</code> executes the entire workflow when the desired resources are not in the cache. This operation takes time for the first user that retrieves its page. You can consider that it won&#8217;t be a problem since only the first user will be concerned. However, WUIC comes with some possibilities to optimize this case.</p> </div> <div class="paragraph"> <p>First, WUIC can populate the cache for any <code>Nut</code> explicitly declared in your configuration point (for instance in your <code>wuic.xml</code> file) when your server starts. This could be achieved with the following <code>context-param</code> in your <code>web.xml</code> file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;context-param&gt;
        &lt;param-name&gt;c.g.w.wuicWarmupStrategy&lt;/param-name&gt;
        &lt;param-value&gt;SYNC&lt;/param-value&gt;
    &lt;/context-param&gt;</code></pre> </div> </div> <div class="paragraph"> <p>You can specify the <code>ASYNC</code> value instead of <code>SYNC</code> if you want that WUIC populates the cache in parallel of other components deployment to reduce startup time.</p> </div> <div class="paragraph"> <p>If WUIC discovers <code>Nut</code> on the fly by filtering HTML page with the <code>HtmlParserFilter</code> component, it can&#8217;t know what to cache until a client sends the first HTTP request. In that case, WUIC can do its best effort to deliver a response faster by applying synchronously only the mandatory operations.</p> </div> <div class="paragraph"> <p>You can enable this feature like that on your cache engine in your <code>wuic.properties</code> file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code>c.g.wuic.engine.bestEffort=true</code></pre> </div> </div> <div class="paragraph"> <p>Mandatory operations are:</p> </div> <div class="ulist"> <ul> <li> <p>CSS inspection to rewrite relative URL because they are served from a different location</p> </li> <li> <p>Image inspection to generate a sprite if configured</p> </li> <li> <p>Conversion of extended WEB language like <code>Typescript</code></p> </li> </ul> </div> <div class="paragraph"> <p>In best effort mode, all other operations (aggregation, compression) will be done asynchronously when the process result is not cached and the user will get its response faster. Of course, the result won&#8217;t be optimized but you&#8217;ll still improve response time in that case. Finally, once the asynchronous job will be done, cache will be updated and next requests will get transparently the full process result as configured.</p> </div> </div> </div> <div class="sect1"> <h2 id="_feature_comparison">Feature comparison</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_choose_the_right_tool">Choose the right tool</h3> <div class="paragraph"> <p>WUIC provides several features to optimize your statics. Choosing the right feature is important because they will have a different impact on your application in terms of:</p> </div> <div class="ulist"> <ul> <li> <p><code>Performances</code>: statics are optimized but an overhead can exist</p> </li> <li> <p><code>Maintainability</code>: how you integrate the tool has an impact when you maintain your application</p> </li> <li> <p><code>Scalability</code>: some compared feature can limit the power of WUIC, reducing the possibilities if you want to enhance your application</p> </li> </ul> </div> <div class="paragraph"> <p>This document shows those differences to help you make the best choice.</p> </div> </div> <div class="sect2"> <h3 id="_features_overview">Features overview</h3> <div class="ulist"> <ul> <li> <p><code>No-Tag</code>: just refer URL mapped to the WUIC servlet in your <code>&lt;script&gt;</code>, <code>&lt;link&gt;</code> and <code>&lt;img&gt;</code> elements when you write the HTML page</p> </li> <li> <p><code>Per-Page-Configuration</code> with <a href="tutorials.html#_configure_resource_location_in_jsp">JSP</a> or <a href="tutorials.html#_create_your_template">Thymeleaf</a></p> </li> <li> <p><code>Startup-Configuration</code> (for instance with configuration in <code>wuic.xml</code>) with <code>JSP</code> or <code>Thymeleaf</code> support to write imports</p> </li> <li> <p><a href="tutorials.html#_use_the_servlet_filter">Servlet-Filter</a></p> </li> <li> <p><a href="tutorials.html#_process_at_build_time">Build-Time</a></p> </li> </ul> </div> <table> <tr> <td><b>Feature</b></td> <td><b>Performance</b></td> <td><b>Maintain</b></td> <td><b>Scalable</b></td> </tr> <tr> <td><b><i>No-Tag</i></b></td> <td><b><i>Good</i></b></td> <td><b><i>Limited</i></b></td> <td><b><i>Limited</i></b></td> </tr> <tr> <td colspan="4"> Full front-end development with no server-side page generation. It becomes necessary to re-deploy your application each time a new version needs to be published. You need also to evict by yourself browser cache. </td> </tr> <tr> <td><b><i>Startup-Configuration</i></b></td></td> <td><b><i>Good</i></b></td> <td><b<i>Good</i></b></td> <td><b><i>Good</i></b></td> </tr> <tr> <td colspan="4">Server-side page generation with all configurations in one location (wuic.xml)</td> </tr> <tr> <td><b><i>Per-Page-Configuration</i></b></td> <td><b><i>Limited</i></b></td> <td><b><i>Good</i></b></td> <td><b><i>Excellent</i></b></td> </tr> <tr> <td colspan="4"> Server-side page generation with more configurations added in each page. Perfect when having a lot of pages with dedicated statics: it's more easy to declare them in the single page using it instead of declaring them in a big wuic.xml file. Configuration is discovered when user loads the page. "c.g.wuic.facade.multipleConfigInTagSupport" setting set to false helps to reduce response time.</td> </tr> <tr> <td><b><i>Servlet-Filter</i></b></td> <td><b><i>Limited</i></b></td> <td><b><i>Excellent</i></b></td> <td><b><i>Limited</i></b></td> </tr> <tr> <td colspan="4"> Legacy pages that takes too much time to migrate to use tags. Statics are discovered when the user loads the page. Best effort mode can help to reduce response time. </td> </tr> <tr> <td><b><i>Build-Time</i></b></td> <td><b><i>Excellent</i></b></td> <td><b><i>Limited</i></b></td> <td><b><i>Good</i></b></td> </tr> <tr> <td colspan="4"> Not necessary to reload statics at runtime. It becomes necessary to re-deploy your application each time a new version needs to be published. </td> </tr> </table> <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script> <script type="text/javascript" src="/pages/1043268269/000000004EE7BAAFaggregate.js"></script>
  </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-08-01 09:55:47 +01:00 </div> </div> </body> </html>