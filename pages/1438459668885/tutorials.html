<!DOCTYPE html> <html manifest="/pages/1438459668885/tutorials.html.appcache" lang="en"> <head><link rel="preload" href="/pages/2861444051/0000000010D490C3aggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1607744212/000000006B8EFF0Daggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1438459669000/bootstrap/css/a/../img/glyphicons-halflings.png" as="image" />
<link rel="preload" href="/pages/1438459669000/bootstrap/css/a/../img/glyphicons-halflings-white.png" as="image" />
<link rel="preload" href="/pages/1438459669000/wiki-css/a/../wiki-images/background.png" as="image" />
<link rel="preload" href="/pages/1438459669211/font-awesome/css/a/../font/fontawesome-webfont.eot" as="font" />
<link rel="preload" href="/pages/1438459669215/font-awesome/css/a/../font/fontawesome-webfont.woff" as="font" />
<link rel="preload" href="/pages/1438459669214/font-awesome/css/a/../font/fontawesome-webfont.ttf" as="font" />
<link rel="preload" href="/pages/1438459669233/000000006B8EFF0Dwiki-images/logo/favicon.ico" as="image" />
<link rel="preload" href="/pages/3515414341/00000000F3148BD3aggregate.js" as="script" />
 <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.2"> <title>Use the servlet filter</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel="stylesheet" type="text/css" href="/pages/2861444051/0000000010D490C3aggregate.css" />
 </head> <body class="article toc2 toc-right"> <div id="header"> <div id="toc" class="toc2"> <div id="toctitle">Step-by-step 5 minutes tutorials</div> <ul class="sectlevel1"> <li><a href="#_use_the_servlet_filter">Use the servlet filter</a> <ul class="sectlevel2"> <li><a href="#_prerequisites">Prerequisites</a></li> <li><a href="#_purpose">Purpose</a></li> <li><a href="#_choosing_the_right_dependencies">Choosing the right dependencies</a></li> <li><a href="#_configure_your_web_xml">Configure your web.xml</a></li> <li><a href="#_that_s_it">That&#8217;s it</a></li> </ul> </li> <li><a href="#_jsp_thymeleaf_processing">JSP / Thymeleaf processing</a> <ul class="sectlevel2"> <li><a href="#_jsp_tag">JSP tag</a></li> <li><a href="#_thymeleaf_processor">Thymeleaf processor</a></li> <li><a href="#_that_s_it_2">That&#8217;s it</a></li> </ul> </li> <li><a href="#_custom_daos">Custom DAOs</a> <ul class="sectlevel2"> <li><a href="#_specifying_custom_daos">Specifying custom DAOs</a></li> <li><a href="#_important_notes">Important notes</a></li> </ul> </li> <li><a href="#_additional_process">Additional process</a> <ul class="sectlevel2"> <li><a href="#_specifying_your_engines">Specifying your engines</a></li> <li><a href="#_configure_your_engines">Configure your engines</a></li> </ul> </li> <li><a href="#_adding_sprites">Adding sprites</a> <ul class="sectlevel2"> <li><a href="#_applying_sprites_best_practice">Applying sprites best practice</a></li> <li><a href="#_the_heap_to_gather_your_images">The heap to gather your images</a></li> <li><a href="#_import_css_sprites">Import CSS sprites</a></li> <li><a href="#_using_javascript_sprites">Using Javascript sprites</a></li> </ul> </li> <li><a href="#_monitor_changes">Monitor changes</a> <ul class="sectlevel2"> <li><a href="#_feature">Feature</a></li> <li><a href="#_polling_wuic_xml">Polling wuic.xml</a></li> <li><a href="#_polling_nuts">Polling nuts</a></li> </ul> </li> <li><a href="#_logging">Logging</a> <ul class="sectlevel2"> <li><a href="#_common_loggers">Common loggers</a></li> <li><a href="#_special_loggers">Special loggers</a></li> </ul> </li> <li><a href="#_process_at_build_time">Process at build time</a> <ul class="sectlevel2"> <li><a href="#_purpose_2">Purpose</a></li> <li><a href="#_configure_your_pom_xml">Configure your pom.xml</a></li> <li><a href="#_configure">Configure</a></li> <li><a href="#_examples">Examples</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <link rel="stylesheet" type="text/css" href="/pages/1607744212/000000006B8EFF0Daggregate.css" />
<link rel="shortcut icon" href="/pages/1438459669233/000000006B8EFF0Dwiki-images/logo/favicon.ico" />
    <!--[if lt IE 9]><script src="../assets/js/html5shiv.js"></script><![endif]-->   <div class="masthead"> <div class="navbar"> <div class="navbar-inner"> <div class="container"> <ul class="nav" role="navigation"> <li><a href="index.html"><i class="icon-home"></i><span class="hidden-phone">&nbsp;Home</span></a></li> <li><a href="project.html"><i class="icon-star"></i><span class="hidden-phone">&nbsp;Project</span></a></li> <li class="active"><a href="wuic-documentation.html"><i class="icon-book"></i><span class="hidden-phone">&nbsp;Documentation</span></a></li> <li><a href="contact.html"><i class="icon-envelope"></i><span class="hidden-phone">&nbsp;Contact</span></a></li> <li><a href="https://github.com/wuic/wuic" target="_blank" title="Wuic Github"><i class="icon-github"></i><span class="hidden-phone">&nbsp;Github</span></a></li> <li><a href="https://twitter.com/wuic_project" target="_blank"><i class="icon-twitter"></i><span class="hidden-phone">&nbsp;Twitter</span></a></li> </ul> </div> </div> </div> </div> <div class="sect1"> <h2 id="_use_the_servlet_filter">Use the servlet filter</h2> <div class="sectionbody"> <div class="paragraph"> <p>This tutorial shows how you can setup WUIC with minimal configuration to filter any HTML page and serve the optimized result.</p> </div> <div class="sect2"> <h3 id="_prerequisites">Prerequisites</h3> <div class="paragraph"> <p>You need to install first:</p> </div> <div class="ulist"> <ul> <li> <p>JDK 1.6</p> </li> <li> <p>Maven 3</p> </li> <li> <p>Servlet container (we advise to use an already <a href="reference.html#_supported_server_and_known_issues">tested server</a>)</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_purpose">Purpose</h3> <div class="paragraph"> <p>We are going to setup the minimal configuration to process your statics on the fly. In this example, we consider the following statics to be processed at the root of your maven project:</p> </div> <div class="listingblock"> <div class="content"> <pre>.
|--src
   |--main
      |--webapp
         `index.html
         |--css
            `-- foo.css
         |--js
            `--foo.js</pre> </div> </div> <div class="paragraph"> <p>In our <code>index.html</code> file, we refer <code>foo.css</code> and <code>foo.js</code> as external resources using <code>&lt;script&gt;</code> and <code>&lt;link&gt;</code> elements.</p> </div> </div> <div class="sect2"> <h3 id="_choosing_the_right_dependencies">Choosing the right dependencies</h3> <div class="paragraph"> <p>Define in your pom.xml a property 'wuic.version' with the latest release available on <a href="http://search.maven.org/#search|ga|1|wuic">maven central</a> We use SLF4J and WUIC comes with the API as dependency. Please refer to the <a href="http://www.slf4j.org/manual.html">documentation</a> to import the logger you want.</p> </div> <div class="paragraph"> <p>First, import the servlet support for WUIC.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">     &lt;dependency&gt;
         &lt;groupId&gt;com.github.wuic&lt;/groupId&gt;
         &lt;artifactId&gt;wuic-servlet&lt;/artifactId&gt;
         &lt;version&gt;${wuic.version}&lt;/version&gt;
      &lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>In our example, we want to minify CSS, Javascript and HTML code. We can add the <code>htmlcompressor</code> and <code>yuicompressor</code> extensions for that:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
        &lt;artifactId&gt;wuic-htmlcompressor&lt;/artifactId&gt;
        &lt;version&gt;${wuic.version}&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
        &lt;artifactId&gt;wuic-yuicompressor&lt;/artifactId&gt;
        &lt;version&gt;${wuic.version}&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_configure_your_web_xml">Configure your web.xml</h3> <div class="paragraph"> <p>WUIC is bootstrapped automatically thanks to a 'ContextListener` detected by the servlet container. However, you need to specify which resources you want to optimize (here the <code>index.html</code> file). This could be done by installing the WUIC servlet <code>Filter</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;filter&gt;
        &lt;filter-name&gt;htmlParserFiler&lt;/filter-name&gt;
        &lt;filter-class&gt;com.github.wuic.servlet.HtmlParserFilter&lt;/filter-class&gt;
    &lt;/filter&gt;

    &lt;filter-mapping&gt;
        &lt;filter-name&gt;htmlParserFiler&lt;/filter-name&gt;
        &lt;url-pattern&gt;/index.html&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The optimized HTML will refer optimized CSS and Javascript scripts that need to be served at a specific location. To serve processed nuts in our servlet container, you need to declare the WUIC <code>Servlet</code> inside your <code>web.xml</code> file.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;servlet&gt;
        &lt;description&gt;WUIC servlet&lt;/description&gt;
        &lt;servlet-name&gt;wuic&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.github.wuic.servlet.WuicServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Choose your servlet mapping for WUIC, for instance:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;wuic&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/wuic/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_that_s_it">That&#8217;s it</h3> <div class="paragraph"> <p>Open you browser display the <code>index.html</code> file. You will see that your HTML code is now minified. Open the referenced JS and CSS scripts, they are also minified!</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> According to the <a href="http://www.w3.org/TR/resource-hints">resource-hints specification</a>, you will see in the HTTP response for the HTML page that one <code>Link</code> header for each external resources as been added. Thus the browser will be able to download those external resources without the need to fetch the HTML page before. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> The first time your page is displayed, the server takes time before responding. This is because WUIC optimizes the page synchronously. After that, the result is added to a memory cache and future HTTP requests will be treated faster. We can take control over the cache implementation and add some configurations to display an already optimized page even the first time the page is loaded, but we will see it later. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> If you reload the page, you will see that resources are loaded from the browser cache. WUIC has sent a far expiry header to the HTTP response in order to put resources in the browser cache. Don&#8217;t worry about cache busting, external resources URL contain a version number that WUIC updates when change are detected. We can also take control over version number computation, and we will see it later. </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="_jsp_thymeleaf_processing">JSP / Thymeleaf processing</h2> <div class="sectionbody"> <div class="paragraph"> <p>We have seen how we can optimize a plain HTML page with the WUIC <code>Filter</code>. If you use a template processor, this tutorial shows how you can inject referenced resources optimized by WUIC in your page. Two sections describe how to do that for good old <code>JSP</code> users and for turned <code>Thymeleaf</code> users.</p> </div> <div class="paragraph"> <p>In our examples, we will consider two JS resources <code>foo.js</code> and <code>bar.js</code> and two CSS resources <code>foo.css</code> and <code>bar.css</code>. Those four files are stored in <code>src/main/resources</code> to be exposed in the root of the classpath at runtime.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> in those tutorials the WUIC <code>Filter</code> could be use to optimize the generated HTML. However, you might not install it if you don&#8217;t see the value of just minifying the HTML code. </td> </tr> </table> </div> <div class="sect2"> <h3 id="_jsp_tag">JSP tag</h3> <div class="sect3"> <h4 id="_use_the_maven_dependency">Use the maven dependency</h4> <div class="paragraph"> <p>You need to add the following dependency in your pom.xml to enable the JSP support:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">      &lt;dependency&gt;
         &lt;groupId&gt;com.github.wuic&lt;/groupId&gt;
         &lt;artifactId&gt;wuic-tag&lt;/artifactId&gt;
         &lt;version&gt;${wuic.version}&lt;/version&gt;
      &lt;/dependency&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_configure_resource_location_in_jsp">Configure resource location in JSP</h4> <div class="paragraph"> <p>First we need to declare the resources to be injected. In your JSP, you can use the tag <code>wuic-config</code> to create a heap called <code>statics</code> that contains nuts corresponding to your statics.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;%@ taglib prefix="wuic-conf" uri="http://www.github.com/wuic/xml-conf" %&gt;
    &lt;wuic-conf:xml-configuration&gt;
        &lt;wuic&gt;
            &lt;heaps&gt;
                &lt;heap id="statics"&gt;
                    &lt;nut-path&gt;js/foo.js&lt;/nut-path&gt;
                    &lt;nut-path&gt;js/bar.js&lt;/nut-path&gt;
                    &lt;nut-path&gt;css/foo.css&lt;/nut-path&gt;
                    &lt;nut-path&gt;css/bar.css&lt;/nut-path&gt;
                &lt;/heap&gt;
            &lt;/heaps&gt;
        &lt;/wuic&gt;
    &lt;/wuic-conf:xml-configuration&gt;</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> by default, WUIC retrieves resources relatively to the root of the classpath. We will see later how we can take control over the location of your resources. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> we can configure resource location outside the JSP. This will be the topic of a subsequent tutorial. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="_create_script_and_link_elements">Create &lt;script&gt; and &lt;link&gt; elements</h4> <div class="paragraph"> <p>Now we have to inject the <code>&lt;script&gt;</code> and <code>&lt;link&gt;</code> element where we want. Just use the <code>wuic:html-import</code> tag to inject the processed nuts in the page:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;%@ taglib prefix="wuic" uri="http://www.github.com/wuic" %&gt;
    &lt;wuic:html-import workflowId="statics"/&gt;</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="_thymeleaf_processor">Thymeleaf processor</h3> <div class="sect3"> <h4 id="_use_the_maven_dependency_2">Use the maven dependency</h4> <div class="paragraph"> <p>You need to add the following dependency in your pom.xml to enable the thymeleaf support:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">      &lt;dependency&gt;
         &lt;groupId&gt;com.github.wuic&lt;/groupId&gt;
         &lt;artifactId&gt;wuic-thymeleaf&lt;/artifactId&gt;
         &lt;version&gt;${wuic.version}&lt;/version&gt;
      &lt;/dependency&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_use_the_dialect">Use the dialect</h4> <div class="paragraph"> <p>Use the WUIC dialect:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">  templateEngine.setDialect(new WuicDialect());</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_create_your_template">Create your template</h4> <div class="paragraph"> <p>First we need to declare the resources to be injected. In your template, you can use the tag <code>wuic-config</code> to create a heap called <code>statics</code> that contains nuts corresponding to your statics.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;wuic:config&gt;
        &lt;wuic&gt;
            &lt;heaps&gt;
                &lt;heap id="statics"&gt;
                    &lt;nut-path&gt;js/foo.js&lt;/nut-path&gt;
                    &lt;nut-path&gt;js/bar.js&lt;/nut-path&gt;
                    &lt;nut-path&gt;css/foo.css&lt;/nut-path&gt;
                    &lt;nut-path&gt;css/bar.css&lt;/nut-path&gt;
                &lt;/heap&gt;
            &lt;/heaps&gt;
        &lt;/wuic&gt;
    &lt;/wuic:config&gt;</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> by default, WUIC retrieves resources relatively to the root of the classpath. We will see later how we can take control over the location of your resources. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> we can configure resource location outside the template. This will be the topic of a subsequent tutorial. </td> </tr> </table> </div> <div class="paragraph"> <p>Then in your head element, just use the attribute processor <code>import</code> to inject the processed nuts in the page:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;head wuic:import="statics"&gt;</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="_that_s_it_2">That&#8217;s it</h3> <div class="paragraph"> <p>Now just run the application and load the page. Both JSP and Thymeleaf tutorials lead to the same result. You will see that one combined JS and one combined CSS have been imported!</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> we have configured WUIC with an XML structure supported by WUIC. You can find a deep description of all configurable elements via XML <a href="api.html#_configuring_the_wuic_xml">here</a>. By the way, we will see progressively all the possibilities offered by the XML configuration step by step in the subsequent tutorials. </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="_custom_daos">Custom DAOs</h2> <div class="sectionbody"> <div class="paragraph"> <p>You can configure precisely how WUIC should access nuts by defining properties in custom DAOs. This tutorial shows how to change the base path in a classpath.</p> </div> <div class="paragraph"> <p>In the previous tutorials we used custom a JSP tag and Thymeleaf processor to configure WUIC. Here we will use a <code>wuic.xml</code> file which needs to be placed at the root of your classpath (<code>src/main/resources</code>).</p> </div> <div class="sect2"> <h3 id="_specifying_custom_daos">Specifying custom DAOs</h3> <div class="paragraph"> <p>If default DAOs are not configured as you want, then you can declare a new configuration like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;nut-dao-builders&gt;
        &lt;nut-dao-builder id="myDao"&gt;
            &lt;properties&gt;
                &lt;property key="c.g.wuic.dao.basePath"&gt;/scripts&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/nut-dao-builder&gt;
    &lt;/nut-dao-builders&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Here we declare a DAO for classpath accesses which will retrieve any nut in /scripts. So, you may have something like that:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;wuic&gt;
    &lt;nut-dao-builders&gt;
        &lt;nut-dao-builder&gt;
            &lt;properties&gt;
                &lt;property key="c.g.wuic.dao.basePath"&gt;/scripts&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/nut-dao-builder&gt;
    &lt;/nut-dao-builders&gt;
    &lt;heaps&gt;
        &lt;heap id="css"&gt;
            &lt;nut-path&gt;css/foo.css&lt;/nut-path&gt;
        &lt;/heap&gt;
        &lt;heap id="js"&gt;
            &lt;nut-path&gt;js/foo.js&lt;/nut-path&gt;
        &lt;/heap&gt;
    &lt;/heaps&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="paragraph"> <p>This configuration manages two files in your classpath: <code>/scripts/css/foo.css</code> and <code>/scripts/js/foo.js</code>!</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> many components that you will discover through the documentation support equivalent properties. For instance, you can set the property <code>c.g.wuic.basePath</code> for both <code>ClasspathNutDao</code> (classpath access) and <code>DiskNutDao</code> (filesystem access). If you want to set the same value for a given property in all components, then you can drop a <code>wuic.properties</code> file in <code>src/main/resources</code> in order to locate it in the classpath root. In this property file, you can add all the properties and their value. For example, to specify the use of a wildcard <code>*</code> in the paths to resolve, write something like this: </td> </tr> </table> </div> <div class="listingblock"> <div class="content"> <pre># wuic.properties
# this property will be set for all components that support it
c.g.wuic.dao.wildcard=true</pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> by default the DAO load resources from the classpath if you don&#8217;t specify the <code>type</code> attribute in the <code>nut-dao-id-builder</code>. Writing <code>&lt;nut-dao-builder&gt;</code> is equivalent to <code>&lt;nut-dao-builder type="ClasspathNutDaoBuilder"&gt;</code>. You can find all the supported DAO with a deep description of this API <a href="api.html#_configuring_the_nutdao">here</a> </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_important_notes">Important notes</h3> <div class="admonitionblock caution"> <table> <tr> <td class="icon"> <div class="title">Caution</div> </td> <td class="content"> any nuts referenced by the declared nut should be accessible from its associated DAO. Common mistake is for instance to import an image in 'background' rule inside a CSS with a path not relative to the DAO&#8217;s base path associated to the CSS nut. </td> </tr> </table> </div> <div class="paragraph"> <p>For instance, this configuration won&#8217;t work:</p> </div> <div class="ulist"> <ul> <li> <p>DAO with base path <code>/css</code></p> </li> <li> <p>Nut with path <code>foo.css</code></p> </li> <li> <p>An image referenced in <code>foo.css</code> with <code>url('image/foo.png')</code></p> </li> <li> <p>A structure like this:<br> |_ <code>css/foo.css</code><br> |_ <code>image/foo.png</code></p> </li> </ul> </div> <div class="paragraph"> <p>Because the base path of the DAO associated to <code>foo.js</code> is <code>/css</code>, the image referenced in <code>foo.css</code> will be expected to be found at <code>/css/image/foo.png</code>.</p> </div> <div class="paragraph"> <p>Finally, it is better to define for instance a base path called '/statics' and to have a structure like this:<br> |_ <code>statics/css/foo.css</code><br> |_ <code>statics/image/foo.png</code></p> </div> <div class="admonitionblock caution"> <table> <tr> <td class="icon"> <div class="title">Caution</div> </td> <td class="content"> another reason to specify a particular base path is to make the file research faster. If you let the default base path, a large set of unnecessary files could be scanned. </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="_additional_process">Additional process</h2> <div class="sectionbody"> <div class="paragraph"> <p>Behind each process operation, an engine is run. WUIC is fully modular and use engines provided out of the box. However, caching or compressing are some tasks you may want to delegate to external APIs like YUICompressor or EhCache. We will introduce how to do this with WUIC for those two APIs.</p> </div> <div class="sect2"> <h3 id="_specifying_your_engines">Specifying your engines</h3> <div class="paragraph"> <p>First of all, you have to put the right dependencies in your project. In this tutorial, we will replace the default cache implementation based on a memory <code>Map</code> by the <code>EHCache</code> support.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
        &lt;artifactId&gt;wuic-ehcache&lt;/artifactId&gt;
        &lt;version&gt;${wuic.version}&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>And that&#8217;s it! WUIC is able to auto-detect any extension added to the classpath and use it when processing nuts!</p> </div> <div class="paragraph"> <p>You&#8217;ll see in your logs that EhCache is now used to cache the results.</p> </div> </div> <div class="sect2"> <h3 id="_configure_your_engines">Configure your engines</h3> <div class="paragraph"> <p>With a little bit more of work, you can also configure the available properties of your engines.</p> </div> <div class="paragraph"> <p>The following configuration disables the cache:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;engine-builders&gt;
    &lt;engine-builder type="EhCacheEngineBuilder"&gt;
        &lt;properties&gt;
            &lt;property key="c.g.wuic.engine.cache"&gt;false&lt;/property&gt;
        &lt;/properties&gt;
    &lt;/engine-builder&gt;
&lt;/engine-builders&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Another solution is to add <code>c.g.wuic.engine.cache=false</code> in a <code>wuic.properties</code> file located in the classpath root. Note that with this approach the state will change for any component supporting the <code>c.g.wuic.engine.cache</code> property.</p> </div> <div class="paragraph"> <p>You will find all the available engines and the possible properties <a href="api.html#_configuring_the_engines">here</a>.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> for each engine, WUIC creates an instance used by default when some nuts are processed. The ID always match the naming convention <code>wuicDefault[engine-builder-name]</code>. For instance, the EHCache engine is called <code>EhCacheEngine</code> so the builder&#8217;s ID will be <code>wuicDefaultEhCacheEngineBuilder</code>. If the <code>engine-builder-id</code> attribute is not set in the <code>engine-builder</code> element, a default instance is used. So writing <code>&lt;engine-builder type="EhCacheEngineBuilder" engine-builder-id="wuicDefaultEhCacheEngineBuilder"&gt;</code> is equivalent to <code>&lt;engine-builder type="EhCacheEngineBuilder"&gt;</code>. </td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="_adding_sprites">Adding sprites</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_applying_sprites_best_practice">Applying sprites best practice</h3> <div class="paragraph"> <p>You can easily apply your sprites in <a href="http://www.w3schools.com/css/css_image_sprites.asp">css</a>. However, combining your images takes time. This tutorial shows how WUIC help developers to generate sprites.</p> </div> </div> <div class="sect2"> <h3 id="_the_heap_to_gather_your_images">The heap to gather your images</h3> <div class="paragraph"> <p>Declare all your images in a classic heap:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;heap id="img" dao-builder-id="imageDao"&gt;
    &lt;nut-path&gt;/foo.png&lt;/nut-path&gt;
    &lt;nut-path&gt;/bar.png&lt;/nut-path&gt;
&lt;/heap&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_import_css_sprites">Import CSS sprites</h3> <div class="paragraph"> <p>If you have imported the underlying <code>img</code> workflow in your page, then you can assume that a CSS stylesheet with <code>img_foo</code> and <code>img_bar</code> classes are available so you can display each image by applying the associated class to any DOM element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">&lt;span class="img_foo"&gt;&lt;/span&gt;
...
&lt;span class="img_bar"&gt;&lt;/span&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Find a sample <a href="https://github.com/gdrouet/wuic/tree/wuic-0.5.x-snapshot/samples/css-sprite-sample">here</a>.</p> </div> </div> <div class="sect2"> <h3 id="_using_javascript_sprites">Using Javascript sprites</h3> <div class="paragraph"> <p>For developers using a HTML5 framework like <a href="http://gwennaelbuchet.github.io/SceneGraph/">SceneGraph</a>, you can specify the generation of javascript sprites.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;engine-builders&gt;
    &lt;engine-builder id="wuicDefaultImageAggregatorEngineBuilder" type="ImageAggregatorEngineBuilder"&gt;
        &lt;properties&gt;
            &lt;property key="c.g.wuic.engine.spriteProviderClassName"&gt;javascript&lt;/property&gt;
        &lt;/properties&gt;
    &lt;/engine-builder&gt;
&lt;/engine-builders&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Where you finally import your "img" workflow, you can use in Javascript WUIC_SPRITE['img_foo'] and WUIC_SPRITE['img_bar'] to get an object with following properties: - x: x-position from the left inside the merged image - y: y-position from the top inside the merged image - w: the image width - y: the image height - url: the image URL</p> </div> <div class="paragraph"> <p>For <a href="http://gwennaelbuchet.github.io/SceneGraph.js">SceneGraph</a> users, you can use this <a href="https://github.com/wuic/wuic-samples/blob/wuic-0.5.x-snapshot/js-sprite-sample/src/main/webapp/cgsg/ext/WUICCGSGNodeImageFactory.js">factory</a> and generate a <code>CGSGNodeImage</code> like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">var imageFactory = new WUICCGSGNodeImageFactory("img");
var node = imageFactory.create('img_foo');
...</code></pre> </div> </div> <div class="paragraph"> <p>A sample can be found <a href="https://github.com/wuic/wuic-samples/blob/wuic-0.5.x-snapshot/js-sprite-sample/">here</a>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_monitor_changes">Monitor changes</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_feature">Feature</h3> <div class="paragraph"> <p>WUIC offers to users the possibility to load external resources (configurations and nuts). This tutorial shows how to enable a polling mechanism that detects any modification.</p> </div> </div> <div class="sect2"> <h3 id="_polling_wuic_xml">Polling wuic.xml</h3> <div class="paragraph"> <p>In your <code>wuic.xml</code> file, add the following attribute to root element:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">&lt;wuic polling-interval-seconds="10"&gt;
    ...
&lt;/wuic&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Every 10 seconds, WUIC checks if the file has been modified. If it is the case, then the configuration is reloaded without need redeploy your application or restart server.</p> </div> <div class="paragraph"> <p>To specify a different location of <code>wuic.xml</code> file, you can use following <code>init-param</code> in <code>web.xml</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;context-param&gt;
        &lt;param-name&gt;c.g.w.wuicXmlPath&lt;/param-name&gt;
        &lt;param-value&gt;file:/my_app/wuic.xml&lt;/param-value&gt;
    &lt;/context-param&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_polling_nuts">Polling nuts</h3> <div class="paragraph"> <p>You can enable polling on a particular DAO like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;nut-dao-builder type="DiskNutDaoBuilder"&gt;
    &lt;properties&gt;
        &lt;property key="c.g.wuic.dao.basePath"&gt;file:/my_app/statics&lt;/property&gt;
        &lt;property key="c.g.wuic.dao.pollingInterval"&gt;3600&lt;/property&gt;
    &lt;/properties&gt;
&lt;/nut-dao-builder&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Each hour, all nuts creates with the DAO will be polled. If any change is detected, then both browser and server caches are evicted to reload them.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_logging">Logging</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_common_loggers">Common loggers</h3> <div class="paragraph"> <p>WUIC uses <code>slf4j</code> as logging facade, which allows you to plug any supported logger behind the scene. All log levels are used by the library:</p> </div> <div class="ulist"> <ul> <li> <p><code>DEBUG</code> logs are very verbose and should be activated only for debug purpose</p> </li> <li> <p><code>INFO</code> should be activated when you want to make sure that WUIC is active</p> </li> <li> <p><code>WARN</code> logs detect something you should not expect, while they don&#8217;t mean the static won&#8217;t be delivered to the client, hey should be always activated</p> </li> <li> <p><code>ERROR</code> logs mean that WUIC won&#8217;t deliver the statics successfully.</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_special_loggers">Special loggers</h3> <div class="paragraph"> <p>In addition WUIC provides special loggers using <code>TRACE</code> level:</p> </div> <div class="ulist"> <ul> <li> <p><code>com.github.wuic.Logging.TIMER</code> will log all measured amount of time taken by process executions</p> </li> <li> <p><code>com.github.wuic.Logging.POLLING</code> will log all polling operations when you monitor nuts or configuration file</p> </li> </ul> </div> <div class="paragraph"> <p>As an example, a configuration with <code>spring-boot</code> could be:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code>    logging.level.com.github.wuic.Logging.TIMER: TRACE
    logging.level.com.github.wuic.Logging.POLLING: TRACE</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_process_at_build_time">Process at build time</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_purpose_2">Purpose</h3> <div class="paragraph"> <p>Processing at build time could be a great solution for different use cases:</p> </div> <div class="ulist"> <ul> <li> <p>Statics are not served from your application server.</p> </li> <li> <p>Application server can&#8217;t reach the server that serves statics to upload it.</p> </li> <li> <p>You don&#8217;t use any Java application server but you use maven to package your application.</p> </li> <li> <p>You don&#8217;t need to reload some configuration/statics at runtime and you want to reduce as much as possible the resources consumed at runtime by WUIC on your application server.</p> </li> </ul> </div> <div class="paragraph"> <p>There are one benefit and one concern of build time solution:</p> </div> <div class="ulist"> <ul> <li> <p>Benefit: build time processing will turn to 0 the overhead induced by WUIC at runtime</p> </li> <li> <p>Concern: no polling to reload both configuration and nuts at runtime</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_configure_your_pom_xml">Configure your pom.xml</h3> <div class="sect3"> <h4 id="_options">Options</h4> <div class="paragraph"> <p>Both task and maven plugin allow to configure the following options:</p> </div> <div class="ulist"> <ul> <li> <p><code>xml</code>: the <code>wuic.xml</code> file location (which is configured as usual)</p> </li> <li> <p><code>properties</code>: the <code>wuic.properties</code> file location (which is optional)</p> </li> <li> <p><code>output</code>: base path where results are written by the plugin</p> </li> <li> <p><code>charset</code>: by default <code>UTF-8</code>, change it if you want to write processed text content (scripts, SVG, etc) with a different encoding</p> </li> <li> <p><code>contextPath</code>: the context path of the web server that will serve the generated statics (which is optional)</p> </li> </ul> </div> <div class="paragraph"> <p>You will see in the next sections how they can be declared.</p> </div> </div> <div class="sect3"> <h4 id="_with_maven_plugin">With Maven plugin</h4> <div class="paragraph"> <p>You can use the <code>static-helper-maven-plugin</code> that is commonly configured like that in the build section of your <code>pom.xml</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;com.github.wuic.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;static-helper-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;phase&gt;generate-resources&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;process&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
    &lt;configuration&gt;
        &lt;xml&gt;src/main/resources/wuic.xml&lt;/xml&gt;
        &lt;properties&gt;src/main/resources/wuic.properties&lt;/properties&gt;
        &lt;relocateTransformedXml&gt;true&lt;/relocateTransformedXml&gt;
        &lt;output&gt;${build.finalName}&lt;/output&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The maven plugin has the following specific options:</p> </div> <div class="ulist"> <ul> <li> <p><code>relocateTransformedXml</code>: when set to true, after statics have been processed, the plugin will move a transformed <code>wuic.xml</code> file to your out directory with some metadata files. This will allow the servlet to serve the process result from the application server by picking information from classpath.</p> </li> </ul> </div> </div> <div class="sect3"> <h4 id="_with_ant_integration">With ANT integration</h4> <div class="paragraph"> <p>WUIC support <code>ant</code> integration. For instance, you can configure the <code>maven-antrun-plugin</code> like that:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;artifactId&gt;maven-antrun-plugin&lt;/artifactId&gt;
    &lt;version&gt;1.8&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;phase&gt;prepare-package&lt;/phase&gt;
            &lt;configuration&gt;
                &lt;target name="wuic-target"&gt;
                    &lt;property name="wuic-jar" value="${maven.dependency.com.github.wuic.wuic-core.jar.path}"/&gt;
                    &lt;property name="wuic-output" value="${project.build.directory}/${project.build.finalName}" /&gt;
                    &lt;ant antfile="${basedir}/build.xml"&gt;
                        &lt;target name="wuic-task"/&gt;
                    &lt;/ant&gt;
                &lt;/target&gt;
            &lt;/configuration&gt;
            &lt;goals&gt;
                &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre> </div> </div> <div class="paragraph"> <p>In your <code>build.xml</code> file, just add:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;project&gt;
    &lt;target name="wuic-task"&gt;
        &lt;taskdef name="wuic" classname="com.github.wuic.WuicTask" classpath="${wuic-jar}"/&gt;
        &lt;wuic xml="src/main/resources/wuic-ant.xml"
              properties="target/classes/wuic-ant.properties"
              relocateTransformedXmlTo="${wuic-output}/WEB-INF/classes"
              output="${wuic-output}"
        /&gt;
    &lt;/target&gt;
&lt;/project&gt;</code></pre> </div> </div> <div class="paragraph"> <p>The task has the following specific options:</p> </div> <div class="ulist"> <ul> <li> <p><code>relocateTransformedXmlTo</code>: if defined, a location where the transformed <code>wuic.xml</code> file some metadata must be written. This directory should be added to your classpath at runtime to allow the servlet to serve the process result from the application server by picking information from classpath.</p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="_configure">Configure</h3> <div class="sect3"> <h4 id="_configure_for_pure_html_pages">Configure for pure HTML pages</h4> <div class="paragraph"> <p>If your application just contains <code>.html</code> files, then you can filter them with WUIC and then directly serve them.</p> </div> <div class="paragraph"> <p>Configure your <code>wuic.xml</code> by adding just a heap that resolves the HTML pages:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;heap id="html" dao-builder-id="htmlClasspathNutDaoBuilder"&gt;
    &lt;nut-path&gt;.*.html&lt;/nut-path&gt;
&lt;/heap&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Then, according to the output location, you will find the transformed HTML files. The extracted scripts are also copied. All files are stored under a directory named with the version number. This way you can deploy the directories in your application server to serve new paths not in the browser cache when content files change.</p> </div> <div class="paragraph"> <p>The <a href="http://wuic.github.io">website</a> serves statics generated with a simple "mvn clean install" and is a good example or the approach. Check the source <a href="https://github.com/wuic/wuic.github.io">here</a>.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> if your statics are not served by the <code>Servlet</code> provided by WUIC, both <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.21">cache</a> and <a href="http://www.w3.org/TR/resource-hints">link</a> headers won&#8217;t be set in the HTTP response for the HTML page. In that case, WUIC will modify the HTML to respectively insert a (<a href="http://www.w3.org/TR/2011/WD-html5-20110525/offline.html)">cache manifest</a> file and a <code>link</code> tag to the content. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> if your statics are going to served by the <code>Servlet container</code>, the <code>ContextListener</code> will automatically install a <code>Filter</code> that optimize each resource by enabling the browser cache. It will also <code>GZIP</code> the content if the client supports it. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="_configure_for_templating_usage">Configure for templating usage</h4> <div class="paragraph"> <p>If you use templating project like <code>JSP</code> or <code>Thymeleaf</code>, then you can build your application as usual and then use the maven plugin to create a file added to the classpath. At runtime, WUIC will read this file which refers statics generated at build time.</p> </div> </div> </div> <div class="sect2"> <h3 id="_examples">Examples</h3> <div class="sect3"> <h4 id="_jsp">JSP</h4> <div class="paragraph"> <p>You have the sample <a href="https://github.com/wuic/wuic-samples/tree/wuic-0.5.x-snapshot/build-time-sample/pom.xml">here</a>.</p> </div> </div> <div class="sect3"> <h4 id="_full_static">Full static</h4> <div class="paragraph"> <p><a href="http://wuic.github.io">wuic.github.io</a> is processed by WUIC. You can check the sources in a branch <a href="https://github.com/wuic/wuic.github.io/tree/sources">here</a>. The <code>publish.sh</code> script run WUIC and copy results in <a href="https://github.com/wuic/wuic.github.io/tree/master">master</a> branch.</p> </div> <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script> <script type="text/javascript" src="/pages/3515414341/00000000F3148BD3aggregate.js"></script>
  </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-08-01 17:35:23 +01:00 </div> </div> </body> </html>