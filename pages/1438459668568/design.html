<!DOCTYPE html> <html manifest="/pages/1438459668568/design.html.appcache" lang="en"> <head><link rel="preload" href="/pages/2861444051/00000000185B587Faggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1607744212/000000006B8EFF0Daggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1438459669184/bootstrap/css/a/../img/glyphicons-halflings.png" as="image" />
<link rel="preload" href="/pages/1438459669183/bootstrap/css/a/../img/glyphicons-halflings-white.png" as="image" />
<link rel="preload" href="/pages/1438459669224/wiki-css/a/../wiki-images/background.png" as="image" />
<link rel="preload" href="/pages/1438459669211/font-awesome/css/a/../font/fontawesome-webfont.eot" as="font" />
<link rel="preload" href="/pages/1438459669215/font-awesome/css/a/../font/fontawesome-webfont.woff" as="font" />
<link rel="preload" href="/pages/1438459669214/font-awesome/css/a/../font/fontawesome-webfont.ttf" as="font" />
<link rel="preload" href="/pages/1438459669233/000000006B8EFF0Dwiki-images/logo/favicon.ico" as="image" />
<link rel="preload" href="/pages/3515414341/000000007A3BAFF0aggregate.js" as="script" />
 <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.2"> <title>General architecture and terminology</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel="stylesheet" type="text/css" href="/pages/2861444051/00000000185B587Faggregate.css" />
 </head> <body class="article toc2 toc-right"> <div id="header"> <div id="toc" class="toc2"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#_general_architecture_and_terminology">General architecture and terminology</a></li> <li><a href="#_dependency_management">Dependency management</a> <ul class="sectlevel2"> <li><a href="#_reduce_dependencies">Reduce dependencies</a></li> <li><a href="#_core_dependencies">Core dependencies</a></li> <li><a href="#_extensions">Extensions</a></li> </ul> </li> <li><a href="#_configuration_structure">Configuration structure</a> <ul class="sectlevel2"> <li><a href="#_purpose">Purpose</a></li> <li><a href="#_key_components">Key components</a></li> <li><a href="#_conclusion">Conclusion</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <link rel="stylesheet" type="text/css" href="/pages/1607744212/000000006B8EFF0Daggregate.css" />
<link rel="shortcut icon" href="/pages/1438459669233/000000006B8EFF0Dwiki-images/logo/favicon.ico" />
    <!--[if lt IE 9]><script src="../assets/js/html5shiv.js"></script><![endif]-->   <div class="masthead"> <div class="navbar"> <div class="navbar-inner"> <div class="container"> <ul class="nav" role="navigation"> <li><a href="index.html"><i class="icon-home"></i><span class="hidden-phone">&nbsp;Home</span></a></li> <li><a href="project.html"><i class="icon-star"></i><span class="hidden-phone">&nbsp;Project</span></a></li> <li class="active"><a href="wuic-documentation.html"><i class="icon-book"></i><span class="hidden-phone">&nbsp;Documentation</span></a></li> <li><a href="contact.html"><i class="icon-envelope"></i><span class="hidden-phone">&nbsp;Contact</span></a></li> <li><a href="https://github.com/wuic/wuic" target="_blank" title="Wuic Github"><i class="icon-github"></i><span class="hidden-phone">&nbsp;Github</span></a></li> <li><a href="https://twitter.com/wuic_project" target="_blank"><i class="icon-twitter"></i><span class="hidden-phone">&nbsp;Twitter</span></a></li> </ul> </div> </div> </div> </div> <div class="sect1"> <h2 id="_general_architecture_and_terminology">General architecture and terminology</h2> <div class="sectionbody"> <div class="paragraph"> <p>WUIC is designed to integrate many architectures. This is possible thanks to the following abstract concepts:</p> </div> <div class="ulist"> <ul> <li> <p><strong>Nut</strong>: this is an abstraction of your static file providing its type (JS/CSS) and the stream allowing to read it</p> </li> <li> <p><strong>DAO</strong>: the Data Access Object pattern is used to define the NutDao interface, allowing to manage nuts</p> </li> <li> <p><strong>Heap</strong>: this is a set of nuts that you use to organize them</p> </li> <li> <p><strong>Engine</strong>: the engine is a class which can process your nuts with a particular role (caching, aggregating, compressing, etc)</p> </li> <li> <p><strong>Workflow</strong>: Associates a heap to a <strong>chain of responsibility</strong> composed of engines. This way, the workflow describes how you want to process your nuts.</p> </li> </ul> </div> <div class="paragraph"> <p>The following diagram shows the architecture used by WUIC to optimize your website on the fly:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/ditaa-diagram.png" alt="ditaa diagram" width="1150" height="812"> </div> </div> <div class="paragraph"> <p><strong>Step 1</strong> The browser requires the page corresponding to the link in the address bar on the server. The server can directly serve a HTML page, which can be filtered by the WUIC servlet filter that optimizes it and all its referenced resources. The HTML can also be produced by a processor like JSP or Thymeleaf (which could also be filtered by the WUIC servlet filter). WUIC tags for those libraries can also be called during template processing to generate links pointing to optimized resources.</p> </div> <div class="paragraph"> <p><strong>Step 2</strong> A workflow is executed according to the information associated to the requested page. For now, just remember that in WUIC, a workflow describes the way you want to process a set of statics. The workflow could be created on the fly by the servlet filter or a workflow referenced manually inside a template (through JSP or Thymeleaf).</p> </div> <div class="paragraph"> <p><strong>Step 2a:</strong> the invoked workflow corresponds at least to the resources referenced in the HTML page, and possibly to the HTML page itself if the servlet filter is installed.</p> </div> <div class="paragraph"> <p><strong>Step 3</strong> When a workflow needs to be executed, WUIC looks at first for the statics to be processed. They are provided by an associated <strong>heap</strong>. A heap is also identified by an ID and just contains a set of paths representing the statics to be loaded.</p> </div> <div class="paragraph"> <p><strong>Step 4</strong> The heap just has the paths representing the statics, but it can&#8217;t open the stream to them itself. It consequently uses an associated <strong>DAO</strong> which, thanks to a given path, can provide access to the stream. Remember: the DAO will produce a <strong>nut</strong>. Nut is the term that will be used everywhere in WUIC to represent your static (or you also called a resource).</p> </div> <div class="paragraph"> <p><strong>Step 5</strong> Once the nuts have been returned by the heap, then a <strong>chain of responsibility</strong> composed of <strong>engines</strong> is called to process the nuts. Each engine has a particular purpose. There is an engine for caching, compressing, inspecting or aggregating nuts.</p> </div> <div class="paragraph"> <p><strong>Step 6</strong> Once nuts have been processed by engines, they are returned by the invoker (a servlet, a filter or a tag processor).</p> </div> <div class="paragraph"> <p><strong>Step 7</strong> The result is sent to the browser. If the result contains the optimized version of the required page, then its content is written to the HTTP response. Otherwise, the result is sent under the form of a link added to the HTML page which points to the WUIC servlet. Note that the resource can also be pushed to the client if HTTP/2 is enabled.</p> </div> <div class="paragraph"> <p><strong>Step 8</strong> When the page is fetched by the browser, additional resources (JS, CSS, etc) that have been processed by WUIC could be referenced as links. The links are used to submit a new HTTP request to the WUIC servlet.</p> </div> <div class="paragraph"> <p><strong>Step 9</strong> The WUIC servlet extracts the requested name of the result entry for the specified workflow to be written to the HTTP response.</p> </div> <div class="paragraph"> <p><strong>Step 2b</strong>: when a particular resource is requested, the WUIC servlet executes the workflow like in step 2 to retrieve the content to write. However, you can be sure that the workflow will be executed pretty fast, as a result already exists in the internal cache.</p> </div> </div> </div> <div class="sect1"> <h2 id="_dependency_management">Dependency management</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_reduce_dependencies">Reduce dependencies</h3> <div class="paragraph"> <p>WUIC tries to reduce as much as possible the dependencies of the project. However, we know that we will still depend of some third party libraries because of the complexity of the feature and/or the well known API they provide.</p> </div> <div class="paragraph"> <p>Artifacts are organized in two major repositories:</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://github.com/wuic/wuic/">core</a>: minimal configurations to get essential features in J2SE/JEE environment. It is very light and comes only with two dependencies in runtime scope.</p> </li> <li> <p><a href="https://github.com/wuic/wuic-extensions">extensions</a>: additional features implemented on top of third-party libraries.</p> </li> </ul> </div> <div class="paragraph"> <p>You can see in action design decisions explained bellow by taking a look at the <code>pom.xml</code> of the project and our <a href="https://github.com/wuic/wuic-samples">samples</a>.</p> </div> </div> <div class="sect2"> <h3 id="_core_dependencies">Core dependencies</h3> <div class="sect3"> <h4 id="_slf4j_for_logging">SLF4J for logging</h4> <div class="paragraph"> <p>We decided to use the famous <code>SLF4J</code> API as logger facade in the WUIC project. Every features are based on the <code>wuic-core</code> artifact which comes this dependency: <code>org.slf4j:sl4j-api</code></p> </div> <div class="paragraph"> <p>As explained by the SL4FJ documentation, you will have to add in your project the concrete logging API and its corresponding <code>SLF4J</code> binder you want to use.</p> </div> </div> <div class="sect3"> <h4 id="_asl_annotation_detector">ASL Annotation Detector</h4> <div class="paragraph"> <p>ASL Annotation Detector is a very light project packaged in a single JAR. It&#8217;s used by <code>wuic-core</code> to detect automatically extensions added by the user by scanning the classpath.</p> </div> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <div class="title">Important</div> </td> <td class="content"> this library&#8217;s code is currently embedded in WUIC as it fixes a bug on JBoss/Wildfly not resolved in upstream. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="_provided_jee_dependencies">Provided JEE dependencies</h4> <div class="paragraph"> <p>Finally, the core repository also provide JEE supports. In addition to the <code>wuic-core</code> dependency, those artifacts declare additional dependencies in provided scope because they&#8217;re already provided by the servlet container.</p> </div> </div> </div> <div class="sect2"> <h3 id="_extensions">Extensions</h3> <div class="paragraph"> <p>Some protocols supports are included in the core (like HTTP) because they are not based on any external project.</p> </div> <div class="paragraph"> <p>For others like FTP or SSH, we needed to use some projects like <code>JSCH</code> or <code>commons-net</code> making the protocols easy to use. Each protocol support which requires additional dependencies comes in a separate module you need to include.</p> </div> <div class="paragraph"> <p>The issue is the same for processors. For instance, aggregation is provided by core but minification is enabled only when you add an extension which comes with third party library like <code>YUICompressor</code>.</p> </div> <div class="paragraph"> <p>If you want to use an extension which comes with specific dependencies, you&#8217;ll have to put it in your pom.xml :</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;com.github.wuic.extension&lt;/groupId&gt;
        &lt;artifactId&gt;${wuic-extension-name}&lt;/artifactId&gt;
        &lt;version&gt;${wuic-extension.version}&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_configuration_structure">Configuration structure</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_purpose">Purpose</h3> <div class="paragraph"> <p>Organizing, processing and serving web assets is related to a lot of technical considerations and settings. This document helps to understand how WUIC organizes its configuration points to address those several issues.</p> </div> </div> <div class="sect2"> <h3 id="_key_components">Key components</h3> <div class="paragraph"> <p>The central component used inside WUIC is the <a href="http://wuic.github.io/apidocs/com/github/wuic/Context.html">Context</a>. It knows:</p> </div> <div class="ulist"> <ul> <li> <p>How statics are organized (nuts inside heaps)</p> </li> <li> <p>How statics are processed (workflows)</p> </li> </ul> </div> <div class="paragraph"> <p>It&#8217;s built thanks to a <a href="http://wuic.github.io/apidocs/com/github/wuic/ContextBuilder.html">ContextBuilder</a>. This builder could be configured with several <a href="http://wuic.github.io/apidocs/com/github/wuic/ContextBuilderConfigurator.html">ContextBuilderConfigurator</a>. The <code>wuic.xml</code> file is for instance read by a <a href="http://wuic.github.io/apidocs/com/github/wuic/ContextBuilderConfigurator.html">ContextBuilderConfigurator</a>.</p> </div> <div class="paragraph"> <p>Building the context is automated and managed transparently by the <a href="http://wuic.github.io/apidocs/com/github/wuic/WuicFacade.html">WuicFacade</a>. Its state also contains additional information regarding how the process result is served to client. The facade could be built with a <a href="http://wuic.github.io/apidocs/com/github/wuic/WuicFacadeBuilder.html">WuicFacadeBuilder</a>. The <code>web.xml</code> can declare several facade settings to let a <a href="http://wuic.github.io/apidocs/com/github/wuic/servlet/WuicServletContextListener.html">ContextListener</a> bootstrap WUIC.</p> </div> </div> <div class="sect2"> <h3 id="_conclusion">Conclusion</h3> <div class="paragraph"> <p>You can delegate facade instantiation to a servlet listener in your web.xml and configure the underlying WUIC context with a <code>wuic.xml</code> file. You can also complete or replace configuration with <code>Java Config</code>. Take a look at the different API references to see details.</p> </div> <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script> <script type="text/javascript" src="/pages/3515414341/000000007A3BAFF0aggregate.js"></script>
  </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-08-01 17:35:23 +01:00 </div> </div> </body> </html>