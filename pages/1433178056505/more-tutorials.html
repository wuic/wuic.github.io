<!DOCTYPE html> <html manifest="/pages/1433178056505/more-tutorials.html.appcache" lang="en"> <head><link rel="preload" href="/pages/2861444051/0000000069653BE2aggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/2012135756/000000006B8EFF0Daggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1433178057156/000000006B8EFF0Dwiki-images/logo/favicon.ico" as="image" />
 <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.2"> <title>Spring integration</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel="stylesheet" type="text/css" href="/pages/2861444051/0000000069653BE2aggregate.css" />
 </head> <body class="article toc2 toc-right"> <div id="header"> <div id="toc" class="toc2"> <div id="toctitle">More 5 minutes tutorials</div> <ul class="sectlevel1"> <li><a href="#_spring_integration">Spring integration</a> <ul class="sectlevel2"> <li><a href="#_spring_resource_handling">Spring resource handling</a></li> <li><a href="#_maven_dependency">Maven dependency</a></li> <li><a href="#_integrate_wuic_resolvers">Integrate WUIC resolvers</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <link rel="stylesheet" type="text/css" href="/pages/2012135756/000000006B8EFF0Daggregate.css" />
<link rel="shortcut icon" href="/pages/1433178057156/000000006B8EFF0Dwiki-images/logo/favicon.ico" />
    <!--[if lt IE 9]><script src="../assets/js/html5shiv.js"></script><![endif]-->   <div class="masthead"> <div class="navbar"> <div class="navbar-inner"> <div class="container"> <ul class="nav" role="navigation"> <li><a href="index.html"><i class="icon-home"></i><span class="hidden-phone">&nbsp;Home</span></a></li> <li><a href="project.html"><i class="icon-star"></i><span class="hidden-phone">&nbsp;Project</span></a></li> <li class="active"><a href="documentation.html"><i class="icon-book"></i><span class="hidden-phone">&nbsp;Documentation</span></a></li> <li><a href="contact.html"><i class="icon-envelope"></i><span class="hidden-phone">&nbsp;Contact</span></a></li> <li><a href="https://github.com/wuic/wuic" target="_blank" title="Wuic Github"><i class="icon-github"></i><span class="hidden-phone">&nbsp;Github</span></a></li> <li><a href="https://twitter.com/wuic_project" target="_blank"><i class="icon-twitter"></i><span class="hidden-phone">&nbsp;Twitter</span></a></li> </ul> </div> </div> </div> </div> <div class="sect1"> <h2 id="_spring_integration">Spring integration</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_spring_resource_handling">Spring resource handling</h3> <div class="paragraph"> <p><code>Spring</code> 4.1 exposes a <a href="http://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources">pluggable API</a> allowing to specify custom web resources resolution and transformation. WUIC provides an extension that comes with:</p> </div> <div class="ulist"> <ul> <li> <p>a <a href="http://docs.spring.io/spring-framework/docs/4.1.0.RC2/javadoc-api/org/springframework/web/servlet/resource/PathResourceResolver.html">PathResourceResolver</a> that process your workflow and wraps the resulting nut in a spring resource.</p> </li> <li> <p>a <a href="http://docs.spring.io/spring-framework/docs/4.1.0.RC2/javadoc-api/org/springframework/web/servlet/resource/VersionStrategy.html">VersionStrategy</a> to build public URLs with WUIC which includes in the URL a CRC32 content based hash or the last-modified timestamp regarding your <a href="https://github.com/wuic/wuic/wiki/Data-Access-Object">DAO configuration</a></p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_maven_dependency">Maven dependency</h3> <div class="paragraph"> <p>First you need to add to your <code>pom.xml</code> the maven dependency:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
        &lt;artifactId&gt;wuic-spring&lt;/artifactId&gt;
        &lt;version&gt;${wuic.version}&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_integrate_wuic_resolvers">Integrate WUIC resolvers</h3> <div class="paragraph"> <p><code>Spring</code> offers an easy way to configure resource handling with Java Config.</p> </div> <div class="paragraph"> <p>First, declare your <code>@Configuration</code> class as usual.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Configuration
    @EnableWebMvc
    public class MyWebConfig extends WebMvcConfigurerAdapter {

    }</code></pre> </div> </div> <div class="paragraph"> <p>Then create the <code>WuicFacade</code> to expose it as a bean in the <code>ApplicationContext</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Autowired
    private ApplicationContext applicationContext;

    @Bean
    public WuicFacade wuicFacade() throws WuicException {
        return new WuicFacadeBuilder()
                .contextPath("/resources/")
                .wuicXmlPath(getClass().getResource("/wuic.xml"))
                .build();
    }</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> you can completely ignore the use of <code>wuic.xml</code> and configure WUIC with <a href="api.html#_java_config">Java Config</a>. </td> </tr> </table> </div> <div class="paragraph"> <p>Finally, just use the handy <code>WuicHandlerMapping</code> to inject to spring a bean handling resources with WUIC. Core resolvers are <code>WuicPathResourceResolver</code> and <code>WuicVersionStrategy</code>, but you can create additional implementations.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public SimpleUrlHandlerMapping handleWuicResources(final ServletContext servletContext,
                                                       final ResourceUrlProvider resourceUrlProvider,
                                                       final WuicFacade wuicFacade) {
        final ResourceResolver versionResourceResolver =
                new VersionResourceResolver().addVersionStrategy(new WuicVersionStrategy(), "/**/*");

        final ResourceResolver pathResourceResolver =
                new WuicPathResourceResolver(applicationContext.getBean(WuicFacade.class));

        return new WuicHandlerMapping(applicationContext,
                servletContext,
                resourceUrlProvider,
                wuicFacade,
                Arrays.asList(versionResourceResolver, pathResourceResolver),
                Collections.&lt;ResourceTransformer&gt;emptyList());
    }</code></pre> </div> </div> <div class="paragraph"> <p>You can also override <code>addResourceHandlers</code> method to configure resolvers/transformers outside WUIC.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    public void addResourceHandlers(final ResourceHandlerRegistry registry) {
        final ResourceResolver myResolver = new MyResourceResolver();
        registry.addResourceHandler("/other/**")
                .resourceChain(true)
                .addResolver(myResolver);
    }
----

==== Full example

A full example is available https://github.com/wuic/wuic-samples/tree/wuic-0.5.x-snapshot/spring-sample[here].
In addition, it shows how you can mix built-in spring resolvers with WUIC and how to handle public URLs with `Thymeleaf`.

== AngularJS

=== Feature

WUIC provides out of the box an `AngularJS` support and optimize the `templateUrl` option by default!
This topic gives you the details.

===  Writing your directives

AngularJS is MV* framework which advises the use of custom directives. As described in https://docs.angularjs.org/guide/directive[the documentation]:

[lead]
Best Practice: Unless your template is very small, it's typically better to break it apart into its own HTML file and load it with the `templateUrl` option.

This means that when `AngularJS` will instantiate the directive, an additional HTTP request will be executed to load the template content.
This leads to two issues:

* the user must waits the HTTP request is done to see the content displayed
* you should take care of client cache, which must be burst each time you deploy a new version with a different template

### Inlining

WUIC takes care of templateUrl occurrences in javascript code and replace it with a template option.

For example, imagine you have the following directory tree:

----
    .
    |--app
       |--myFeature
          |--directive
             `-- myDirective.js
          |--template
             `-- myTemplate.html
----

`myTemplate.html`:


[source,html]
----
    &lt;h1&gt;My Template  Title&lt;/h1&gt;
----

In your `myDirective.js` file, you can refer myTemplate.html with an URL relative to your script location:


[source,javascript]
----
    myModule.directive('myDirective', function() {
       return {
           templateUrl: '../template/myTemplate.html'
       };
    });
----

When WUIC parses `myTemplate.js`, you will obtain something like that:

[source,javascript]
----
    myModule.directive('myDirective', function() {
       return {
           template: '&lt;h1&gt;My Template  Title&lt;/h1&gt;'
       };
    });
----

WUIC solves two issues:

* You save the additional HTTP request
* As each file processed by WUIC is served with a different URL each time the content change, you make sure the client cache is burst when you update the template

=== Best effort

Note that in best effort mode, WUIC serves the content as fast as possible and just rewrite the template URL, without running inlining process.

=== Natural Templating

If you want to mix natural templating and WUIC's `AngularJS` optimization feature, you must read this important page (TODO: migrate https://github.com/wuic/wuic/wiki/Natural-Templating-with-AngularJS).

== Typescript integration

=== The tsc command

`Typescript` could be installed in several ways.
If you are a `Node.JS` user, then you will be able to compile your source files with the 'tsc' command:

----
Examples: tsc hello.ts
          tsc --out file.js file.ts
          tsc @args.txt
----

Many options are available, like specifying the ECMAScript version or the sourcemap generation.

WUIC comes with an extension which is able to compile typescript files. The extension works in two modes:

* executing the tsc command, which is faster but requires to install the module with Node.JS
* executing a compiler wrapper on top of rhino, which is slower but crossplatform

=== Configuration

First of all, you need to add the dependency to your project:

[source,xml]
----
&lt;dependency&gt;
    &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;wuic-typescript&lt;/artifactId&gt;
    &lt;version&gt;${wuic.version}&lt;/version&gt;
&lt;/dependency&gt;
----

Then, you can write your HTML page by referencing your scripts:

[source,html]
----
&lt;script src="greeter.ts"&gt;&lt;/script&gt;
&lt;script src="use.greeter.ts"&gt;&lt;/script&gt;
----

Then you can just include the HTML page in the WUIC process, for instance by declaring it in your `wuic.xml` (TODO: migrate https://github.com/wuic/wuic/wiki/Understanding-wuic.xml)
file or just filtering it with the servlet filter (TODO: migrate https://github.com/wuic/wuic/wiki/filter-html).

When WUIC transforms the HTML page, it replaces the initial referenced typescript file by the compiled javascript file:

[source,html]
----
&lt;script src="/wuic/56321344/myWorkflow/aggregate.ts.js"&gt;&lt;/script&gt;
----

WUIC also serves a sourcemap file referenced in the compiled javascript.

=== Crossplatform configuration

By default, you don't need to install Node.JS to compile your typescript source files with WUIC.
The extension takes advantage from the https://www.npmjs.com/package/typescript-compiler[tsc wrapper project],
which is run with https://github.com/apigee/trireme[trireme], a `Node.JS` compatibility layer for the JVM.

However, because trireme uses `Rhino` to executes javascript code, the compilation is slow, even with the optimizations provided by the project.
This is not really a problem because compilation is performed at build time or when the server starts at runtime,
but in development you need to compile each time you change your sources.
In this case you might need to enable command line execution.

=== tsc command line execution

The tsc command line compiles your sources 10x faster than rhino-based compiler and could be very useful when you need to recompile your scripts in development.

Before switching to this mode, you need to install the typescript compiler:

----
npm install -g typescript
----

Then, just set the `c.g.wuic.engine.useNodeJs` setting to true in the `TypescriptConverterEngineBuilder`.
For instance, if you configure engines in your `wuic.xml`, you will write this:

[source,xml]
----
&lt;engine-builders&gt;
    &lt;engine-builder type="TypescriptConverterEngineBuilder"&gt;
        &lt;properties&gt;
            &lt;property key="c.g.wuic.engine.useNodeJs"&gt;true&lt;/property&gt;
        &lt;/properties&gt;
    &lt;/engine-builder&gt;
&lt;/engine-builders&gt;
----

Note: you can filter the value with maven to set this setting to true only in a development profile.
When you'll go in production, the setting will be false and you won't need to ask your ops to install `Node.JS`

++++
&lt;!-- javascript
================================================== --&gt;
&lt;!-- Placed at the end of the document so the pages load faster --&gt;
&lt;script src="http://code.jquery.com/jquery-1.10.0.min.js"&gt;&lt;/script&gt;
&lt;script src="bootstrap/js/bootstrap.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-40383819-1', 'github.io');
    ga('send', 'pageview');
&lt;/script&gt;
++++</code></pre> </div> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-06-01 12:35:33 +01:00 </div> </div> </body> </html>