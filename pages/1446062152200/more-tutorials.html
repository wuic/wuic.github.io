<!DOCTYPE html> <html manifest="/pages/1446062152200/more-tutorials.html.appcache" lang="en"> <head><link rel="preload" href="/pages/2861444051/0000000069653BE2aggregate.css" as="stylesheet"/> <link rel="preload" href="/pages/3728078622/000000006B8EFF0Daggregate.css" as="stylesheet"/> <link rel="preload" href="/pages/1446062153641/bootstrap/css/a/../img/glyphicons-halflings-white.png" as="image"/> <link rel="preload" href="/pages/1446062153645/bootstrap/css/a/../img/glyphicons-halflings.png" as="image"/> <link rel="preload" href="/pages/1446062153000/wiki-css/a/../wiki-images/background.png" as="image"/> <link rel="preload" href="/pages/1446062153710/font-awesome/css/a/../font/fontawesome-webfont.eot" as="font"/> <link rel="preload" href="/pages/1446062153721/font-awesome/css/a/../font/fontawesome-webfont.woff" as="font"/> <link rel="preload" href="/pages/1446062153718/font-awesome/css/a/../font/fontawesome-webfont.ttf" as="font"/> <link rel="preload" href="/pages/1446062153781/000000006B8EFF0Dwiki-images/logo/favicon.ico" as="image"/> <link rel="preload" href="/pages/3905848312/000000009ED4419Faggregate.js" as="script"/> <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.2"> <title>Spring integration</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel="stylesheet" type="text/css" href="/pages/2861444051/0000000069653BE2aggregate.css"/> </head> <body class="article toc2 toc-right"> <div id="header"> <div id="toc" class="toc2"> <div id="toctitle">More 5 minutes tutorials</div> <ul class="sectlevel1"> <li><a href="#_spring_integration">Spring integration</a> <ul class="sectlevel2"> <li><a href="#_spring_resource_handling">Spring resource handling</a></li> <li><a href="#_maven_dependency">Maven dependency</a></li> <li><a href="#_integrate_wuic_resolvers">Integrate WUIC resolvers</a></li> </ul> </li> <li><a href="#_angularjs">AngularJS</a> <ul class="sectlevel2"> <li><a href="#_feature">Feature</a></li> <li><a href="#_writing_your_directives">Writing your directives</a></li> <li><a href="#_inlining">Inlining</a></li> <li><a href="#_best_effort">Best effort</a></li> <li><a href="#_natural_templating">Natural Templating</a></li> </ul> </li> <li><a href="#_typescript_integration">Typescript integration</a> <ul class="sectlevel2"> <li><a href="#_the_tsc_command">The tsc command</a></li> <li><a href="#_configuration">Configuration</a></li> <li><a href="#_crossplatform_configuration">Crossplatform configuration</a></li> <li><a href="#_tsc_command_line_execution">tsc command line execution</a></li> </ul> </li> <li><a href="#_command_lines_execution">Command lines execution</a> <ul class="sectlevel2"> <li><a href="#_purpose">Purpose</a></li> <li><a href="#_command_line_configuration">Command line configuration</a></li> <li><a href="#_using_nodejs_with_npm_command_line">Using NodeJS with NPM command line</a></li> </ul> </li> <li><a href="#_enable_http_2">Enable HTTP/2</a> <ul class="sectlevel2"> <li><a href="#_purpose_2">Purpose</a></li> <li><a href="#_java_server">Java server</a></li> <li><a href="#_http_2_and_nghttpx">HTTP/2 and nghttpx</a></li> </ul> </li> <li><a href="#_natural_templating_with_angularjs">Natural templating with AngularJS</a> <ul class="sectlevel2"> <li><a href="#_purpose_3">Purpose</a></li> <li><a href="#_design">Design</a></li> <li><a href="#_demonstration">Demonstration</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <link rel="stylesheet" type="text/css" href="/pages/3728078622/000000006B8EFF0Daggregate.css"/> <link rel="shortcut icon" href="/pages/1446062153781/000000006B8EFF0Dwiki-images/logo/favicon.ico"/> <!--[if lt IE 9]><script src="../assets/js/html5shiv.js"></script><![endif]--> <div class="masthead"> <div class="navbar"> <div class="navbar-inner"> <div class="container"> <ul class="nav" role="navigation"> <li><a href="index.html"><i class="icon-home"></i><span class="hidden-phone">&nbsp;Home</span></a></li> <li><a href="project.html"><i class="icon-star"></i><span class="hidden-phone">&nbsp;Project</span></a></li> <li class="active"><a href="wuic-documentation.html"><i class="icon-book"></i><span class="hidden-phone">&nbsp;Documentation</span></a></li> <li><a href="contact.html"><i class="icon-envelope"></i><span class="hidden-phone">&nbsp;Contact</span></a></li> <li><a href="https://github.com/wuic/wuic" target="_blank" title="Wuic Github"><i class="icon-github"></i><span class="hidden-phone">&nbsp;Github</span></a></li> <li><a href="https://twitter.com/wuic_project" target="_blank"><i class="icon-twitter"></i><span class="hidden-phone">&nbsp;Twitter</span></a></li> </ul> </div> </div> </div> </div> <div class="sect1"> <h2 id="_spring_integration">Spring integration</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_spring_resource_handling">Spring resource handling</h3> <div class="paragraph"> <p><code>Spring</code> 4.1 exposes a <a href="http://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources">pluggable API</a> allowing to specify custom web resources resolution and transformation. WUIC provides an extension that comes with:</p> </div> <div class="ulist"> <ul> <li> <p>a <a href="http://docs.spring.io/spring-framework/docs/4.1.0.RC2/javadoc-api/org/springframework/web/servlet/resource/PathResourceResolver.html">PathResourceResolver</a> that process your workflow and wraps the resulting nut in a spring resource.</p> </li> <li> <p>a <a href="http://docs.spring.io/spring-framework/docs/4.1.0.RC2/javadoc-api/org/springframework/web/servlet/resource/VersionStrategy.html">VersionStrategy</a> to build public URLs with WUIC which includes in the URL a CRC32 content based hash or the last-modified timestamp regarding your <a href="https://github.com/wuic/wuic/wiki/Data-Access-Object">DAO configuration</a></p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_maven_dependency">Maven dependency</h3> <div class="paragraph"> <p>First you need to add to your <code>pom.xml</code> the maven dependency:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
        &lt;artifactId&gt;wuic-spring&lt;/artifactId&gt;
        &lt;version&gt;${wuic.version}&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_integrate_wuic_resolvers">Integrate WUIC resolvers</h3> <div class="paragraph"> <p><code>Spring</code> offers an easy way to configure resource handling with Java Config.</p> </div> <div class="paragraph"> <p>First, declare your <code>@Configuration</code> class as usual.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Configuration
    @EnableWebMvc
    public class MyWebConfig extends WebMvcConfigurerAdapter {

    }</code></pre> </div> </div> <div class="paragraph"> <p>Then create the <code>WuicFacade</code> to expose it as a bean in the <code>ApplicationContext</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Autowired
    private ApplicationContext applicationContext;

    @Bean
    public WuicFacade wuicFacade() throws WuicException {
        return new WuicFacadeBuilder()
                .contextPath("/resources/")
                .wuicXmlPath(getClass().getResource("/wuic.xml"))
                .build();
    }</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> you can completely ignore the use of <code>wuic.xml</code> and configure WUIC with <a href="api.html#_java_config">Java Config</a>. </td> </tr> </table> </div> <div class="paragraph"> <p>Finally, just use the handy <code>WuicHandlerMapping</code> to inject to spring a bean handling resources with WUIC. Core resolvers are <code>WuicPathResourceResolver</code> and <code>WuicVersionStrategy</code>, but you can create additional implementations.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public SimpleUrlHandlerMapping handleWuicResources(final ServletContext servletContext,
                                                       final ResourceUrlProvider resourceUrlProvider,
                                                       final WuicFacade wuicFacade) {
        final ResourceResolver versionResourceResolver =
                new VersionResourceResolver().addVersionStrategy(new WuicVersionStrategy(), "/**/*");

        final ResourceResolver pathResourceResolver =
                new WuicPathResourceResolver(applicationContext.getBean(WuicFacade.class));

        return new WuicHandlerMapping(applicationContext,
                servletContext,
                resourceUrlProvider,
                wuicFacade,
                Arrays.asList(versionResourceResolver, pathResourceResolver),
                Collections.&lt;ResourceTransformer&gt;emptyList());
    }</code></pre> </div> </div> <div class="paragraph"> <p>You can also override <code>addResourceHandlers</code> method to configure resolvers/transformers outside WUIC.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    public void addResourceHandlers(final ResourceHandlerRegistry registry) {
        final ResourceResolver myResolver = new MyResourceResolver();
        registry.addResourceHandler("/other/**")
                .resourceChain(true)
                .addResolver(myResolver);
    }</code></pre> </div> </div> <div class="sect3"> <h4 id="_full_example">Full example</h4> <div class="paragraph"> <p>A full example is available <a href="https://github.com/wuic/wuic-samples/tree/wuic-0.5.x-snapshot/spring-sample">here</a>. In addition, it shows how you can mix built-in spring resolvers with WUIC and how to handle public URLs with <code>Thymeleaf</code>.</p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_angularjs">AngularJS</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_feature">Feature</h3> <div class="paragraph"> <p>WUIC provides out of the box an <code>AngularJS</code> support and optimize the <code>templateUrl</code> option by default! This topic gives you the details.</p> </div> </div> <div class="sect2"> <h3 id="_writing_your_directives">Writing your directives</h3> <div class="paragraph"> <p>AngularJS is MV* framework which advises the use of custom directives. As described in <a href="https://docs.angularjs.org/guide/directive">the documentation</a>:</p> </div> <div class="paragraph lead"> <p>Best Practice: Unless your template is very small, it&#8217;s typically better to break it apart into its own HTML file and load it with the <code>templateUrl</code> option.</p> </div> <div class="paragraph"> <p>This means that when <code>AngularJS</code> will instantiate the directive, an additional HTTP request will be executed to load the template content. This leads to two issues:</p> </div> <div class="ulist"> <ul> <li> <p>the user must waits the HTTP request is done to see the content displayed</p> </li> <li> <p>you should take care of client cache, which must be burst each time you deploy a new version with a different template</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_inlining">Inlining</h3> <div class="paragraph"> <p>WUIC takes care of templateUrl occurrences in javascript code and replace it with a template option.</p> </div> <div class="paragraph"> <p>For example, imagine you have the following directory tree:</p> </div> <div class="listingblock"> <div class="content"> <pre>    .
    |--app
       |--myFeature
          |--directive
             `-- myDirective.js
          |--template
             `-- myTemplate.html</pre> </div> </div> <div class="paragraph"> <p><code>myTemplate.html</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">    &lt;h1&gt;My Template  Title&lt;/h1&gt;</code></pre> </div> </div> <div class="paragraph"> <p>In your <code>myDirective.js</code> file, you can refer myTemplate.html with an URL relative to your script location:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">    myModule.directive('myDirective', function() {
       return {
           templateUrl: '../template/myTemplate.html'
       };
    });</code></pre> </div> </div> <div class="paragraph"> <p>When WUIC parses <code>myTemplate.js</code>, you will obtain something like that:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">    myModule.directive('myDirective', function() {
       return {
           template: '&lt;h1&gt;My Template  Title&lt;/h1&gt;'
       };
    });</code></pre> </div> </div> <div class="paragraph"> <p>WUIC solves two issues:</p> </div> <div class="ulist"> <ul> <li> <p>You save the additional HTTP request</p> </li> <li> <p>As each file processed by WUIC is served with a different URL each time the content change, you make sure the client cache is burst when you update the template</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_best_effort">Best effort</h3> <div class="paragraph"> <p>Note that in best effort mode, WUIC serves the content as fast as possible and just rewrite the template URL, without running inlining process.</p> </div> </div> <div class="sect2"> <h3 id="_natural_templating">Natural Templating</h3> <div class="paragraph"> <p>If you want to mix natural templating and WUIC&#8217;s <code>AngularJS</code> optimization feature, you must read <a href="more-tutorials.html#_natural_templating_with_angularjs">this important page</a>.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_typescript_integration">Typescript integration</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_the_tsc_command">The tsc command</h3> <div class="paragraph"> <p><code>Typescript</code> could be installed in several ways. If you are a <code>Node.JS</code> user, then you will be able to compile your source files with the 'tsc' command:</p> </div> <div class="listingblock"> <div class="content"> <pre>Examples: tsc hello.ts
          tsc --out file.js file.ts
          tsc @args.txt</pre> </div> </div> <div class="paragraph"> <p>Many options are available, like specifying the ECMAScript version or the sourcemap generation.</p> </div> <div class="paragraph"> <p>WUIC comes with an extension which is able to compile typescript files. The extension works in two modes:</p> </div> <div class="ulist"> <ul> <li> <p>executing the tsc command, which is faster but requires to install the module with Node.JS</p> </li> <li> <p>executing a compiler wrapper on top of rhino, which is slower but crossplatform</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_configuration">Configuration</h3> <div class="paragraph"> <p>First of all, you need to add the dependency to your project:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;wuic-typescript&lt;/artifactId&gt;
    &lt;version&gt;${wuic.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Then, you can write your HTML page by referencing your scripts:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">&lt;script src="greeter.ts"&gt;&lt;/script&gt;
&lt;script src="use.greeter.ts"&gt;&lt;/script&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Then you can just include the HTML page in the WUIC process, for instance by declaring it in your <a href="api.html#_configuring_the_wuic_xml">wuic.xml</a> file or just filtering it with the <a href="api.html#_configuring_the_htmlparserfilter">servlet filter</a>.</p> </div> <div class="paragraph"> <p>When WUIC transforms the HTML page, it replaces the initial referenced typescript file by the compiled javascript file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">&lt;script src="/wuic/56321344/myWorkflow/aggregate.ts.js"&gt;&lt;/script&gt;</code></pre> </div> </div> <div class="paragraph"> <p>WUIC also serves a sourcemap file referenced in the compiled javascript.</p> </div> </div> <div class="sect2"> <h3 id="_crossplatform_configuration">Crossplatform configuration</h3> <div class="paragraph"> <p>By default, you don&#8217;t need to install Node.JS to compile your typescript source files with WUIC. The extension takes advantage from the <a href="https://www.npmjs.com/package/typescript-compiler">tsc wrapper project</a>, which is run with <a href="https://github.com/apigee/trireme">trireme</a>, a <code>Node.JS</code> compatibility layer for the JVM.</p> </div> <div class="paragraph"> <p>However, because trireme uses <code>Rhino</code> to executes javascript code, the compilation is slow, even with the optimizations provided by the project. This is not really a problem because compilation is performed at build time or when the server starts at runtime, but in development you need to compile each time you change your sources. In this case you might need to enable command line execution.</p> </div> </div> <div class="sect2"> <h3 id="_tsc_command_line_execution">tsc command line execution</h3> <div class="paragraph"> <p>The tsc command line compiles your sources 10x faster than rhino-based compiler and could be very useful when you need to recompile your scripts in development.</p> </div> <div class="paragraph"> <p>Before switching to this mode, you need to install the typescript compiler:</p> </div> <div class="listingblock"> <div class="content"> <pre>npm install -g typescript</pre> </div> </div> <div class="paragraph"> <p>Then, just set the <code>c.g.wuic.engine.useNodeJs</code> setting to true in the <code>TypescriptConverterEngineBuilder</code>. For instance, if you configure engines in your <code>wuic.xml</code>, you will write this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;engine-builders&gt;
    &lt;engine-builder type="TypescriptConverterEngineBuilder"&gt;
        &lt;properties&gt;
            &lt;property key="c.g.wuic.engine.useNodeJs"&gt;true&lt;/property&gt;
        &lt;/properties&gt;
    &lt;/engine-builder&gt;
&lt;/engine-builders&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Note: you can filter the value with maven to set this setting to true only in a development profile. When you&#8217;ll go in production, the setting will be false and you won&#8217;t need to ask your ops to install <code>Node.JS</code></p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_command_lines_execution">Command lines execution</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_purpose">Purpose</h3> <div class="paragraph"> <p>Sometimes you have a command line tool that just does a part of the work as you want. When using WUIC, you can be in a situation where you would like to integrate the result of any command line execution inside the WUIC workflow. For instance, let&#8217;s imagine that you have a command line that converts <code>LESS</code> files to <code>CSS</code>.</p> </div> <div class="paragraph"> <p>This tutorial will show you how to configure this kind of command line to be executed by WUIC.</p> </div> </div> <div class="sect2"> <h3 id="_command_line_configuration">Command line configuration</h3> <div class="paragraph"> <p>WUIC relies on a special engine to execute command line called <code>CommandLineConverterEngine</code>. By default, this engine does nothing until you configure it to specifies which <code>NutType</code> need to be processed by the engine and which <code>NutType</code> is expected as the result of command line execution.</p> </div> <div class="paragraph"> <p>To specify to the <code>NutType</code>, you need to configure the <code>c.g.wuic.engine.inputNutType</code> and <code>c.g.wuic.engine.outputNutType</code> properties. For instance, you can do it in your <code>wuic.properties</code> file like this:</p> </div> <div class="listingblock"> <div class="content"> <pre>c.g.wuic.engine.inputNutType=LESS
c.g.wuic.engine.outputNutType=CSS</pre> </div> </div> <div class="paragraph"> <p>The value must be a <a href="http://wuic.github.io/apidocs/com/github/wuic/NutType.html">supported</a> <code>NutType</code> name.</p> </div> <div class="paragraph"> <p>At this moment, the engine will be activated and validate the command line to execute. This command line also have to be configured with a dedicated property.</p> </div> <div class="listingblock"> <div class="content"> <pre>c.g.wuic.engine.command=mycmd param1 param2</pre> </div> </div> <div class="paragraph"> <p>WUIC will use this command line to specify where the result and the associated source map should be generated according to a set of files to be converted. When analyzing the command line, WUIC will need to identify three mandatory tokens:</p> </div> <div class="ulist"> <ul> <li> <p><code>%paths%</code>: the token to replace with the input files location</p> </li> <li> <p><code>%outPath%</code>: the token to replace with the result file location</p> </li> <li> <p><code>%sourceMap%</code>: the token to replace with the source map file location</p> </li> </ul> </div> <div class="paragraph"> <p>WUIC will reject your command line if those three tokens are not defined. A valid command looks like this:</p> </div> <div class="listingblock"> <div class="content"> <pre>c.g.wuic.engine.command=mycmd %paths% --sourcemap %sourceMap% &gt; %outPath%</pre> </div> </div> <div class="paragraph"> <p>When executing the command line, WUIC will use this pattern to contextualize a command. For instance, the command that is actually run could looks like this: <code>mycmd /path/to/foo.less /path/to/bar.less --sourcemap /path/to/aggregate.css.map &gt; /path/to/aggregate.css</code></p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> Optionally, you can define the <code>%basePath%</code> token in your command line to let WUIC use a command which looks like <code>mycmd %paths% --baseDir %basePath% --sourcemap %sourceMap% &gt; %outPath%</code> to execute a command which will looks like <code>mycmd foo.less bar.less --baseDir /path/to --sourcemap /path/to/aggregate.css.map &gt; /path/to/aggregate.css</code> </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> by default all file paths are separated by a space, but you can configure it thanks to the <code>c.g.wuic.engine.pathSeparator</code> property. </td> </tr> </table> </div> <div class="paragraph"> <p>If you need to include any additional file in the directory where the command line is executed, you can use the <code>c.g.wuic.engine.libraries</code> property to specify all files path to be copied separated by a semi-colon. The files paths path must corresponds to a resource available in from the classpath.</p> </div> <div class="listingblock"> <div class="content"> <pre>c.g.wuic.engine.libraries=/path/to/lib1;/path/to/lib2;/path/to/lib3</pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> if any token (paths, out paths, source map path or base path) need to be specified in a separate file, you can add it to the file and then consider it as a library to be copied by WUIC. During copy, WUIC will take care of any token to be replaced. If a mandatory token is found in one library, WUIC won&#8217;t fails if this token is not in the configured command. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_using_nodejs_with_npm_command_line">Using NodeJS with NPM command line</h3> <div class="paragraph"> <p>When you need to run <code>npm</code> on top of <code>NodeJs</code> as a command line run by WUIC, you must be sure that <code>npm</code> will be recognized in the working directory. To provide integration facilities of <code>npm</code> command line execution, you can install in your <code>pom.xml</code> file an extension provided by WUIC:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;artifactId&gt;wuic-extensions&lt;/artifactId&gt;
    &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
    &lt;version&gt;${wuic.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>This extension provides an inspector automatically detected and installed by WUIC that relies on the <a href="https://github.com/eirslett/frontend-maven-plugin/tree/master/frontend-plugin-core">frontend-plugin-core</a> module to download <code>NodeJs</code> and <code>NPM</code> in the working directory of any <code>CommandLineConverterEngine</code>.</p> </div> <div class="paragraph"> <p>In your classpath, you just have to create a file called <code>/com.github.wuic.nodejs.NodeJsInspector.config.json</code> that provides the information required by the <code>frontend-plugin-core</code>. The minimal configuration that you need to provide must contain the <code>NodeJs</code> and <code>NPM</code> version to be used. This configuration looks like this:</p> </div> <div class="listingblock"> <div class="content"> <pre>{
    "nodeVersion": "v0.10.30",
    "npmVersion": "1.4.21"
}</pre> </div> </div> <div class="admonitionblock caution"> <table> <tr> <td class="icon"> <div class="title">Caution</div> </td> <td class="content"> the <code>nodeVersion</code> value must starts with <code>v</code> character, while it&#8217;s not required for <code>npmVersion</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>According to the documentation <a href="https://github.com/eirslett/frontend-maven-plugin#installing-node-and-npm">here</a>, you can also consider to specify additional configurations:</p> </div> <div class="ulist"> <ul> <li> <p><code>nodeDownloadRoot</code>: a different URL for <code>NodeJs</code> archives location</p> </li> <li> <p><code>npmDownloadRoot</code>: a different URL for <code>NPM</code> archives location</p> </li> <li> <p><code>proxies</code>: an array of proxies to use where each element is an object which looks like <code>{"id":xxx, "protocol": xxx, "host": xxx, "username": xxx, "password": xxx, "nonProxyHosts": xxx}</code></p> </li> </ul> </div> </div> </div> </div> <div class="sect1"> <h2 id="_enable_http_2">Enable HTTP/2</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_purpose_2">Purpose</h3> <div class="paragraph"> <p>This tutorial shows how you can enable HTTP/2 in your server to let WUIC use this protocol.</p> </div> <div class="paragraph"> <p>HTTP/2 protocol specifies the <code>server-push</code> feature that allows to send over the HTTP response additional resources that the client should require one he fetched the response. For instance, if a browser fetches a HTML content, it will load additional resources like CSS or Javascript files. Actually, we don&#8217;t wait the browser performs a new request and we push those resources earlier.</p> </div> <div class="paragraph"> <p>This method is speculative because we don&#8217;t know that the client will really load the resource. For instance, if the resource is in the browser cache, then the <code>push</code> will be canceled.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> by default, WUIC uses <a href="https://w3c.github.io/resource-hints">resource-hints</a> to let the browser fetch the resources once the HTTP response is sent to the client. This is slower than HTTP/2 <code>server-push</code> but not speculative: if the resource is in the browser cache no unnecessary download will occur. If you enable HTTP/2, then <code>server-push</code> will be used instead of <code>resource-hints</code>. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_java_server">Java server</h3> <div class="paragraph"> <p>Java server and even servlet containers don&#8217;t implement any standard API for HTTP/2. This means that each server comes with its own API that you need to specifically implement. WUIC hides those API and comes with a support for a specific server under the form of a JAR file.</p> </div> <div class="sect3"> <h4 id="_servlet_containers">Servlet containers</h4> <div class="paragraph"> <p>For any servlet container, you must install the <code>com.github.wuic.servlet.HtmlParserFilter</code> to let <code>WUIC</code> initiate a <code>server-push</code> for resources associated to the filtered HTML page.</p> </div> <div class="sect4"> <h5 id="_jetty">Jetty</h5> <div class="paragraph"> <p>First you need to install HTTP/2 with <code>Jetty</code>. This requires the version 9.3+ and the JDK 8. You will find a complete sample in this <a href="https://github.com/wuic/wuic-samples/blob/wuic-0.5.x-snapshot/pom.xml">pom.xml</a>.</p> </div> <div class="paragraph"> <p>Then, you just need to add the dependency corresponding to the <code>Jetty</code> support for WUIC:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;http2-jetty&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>You can run your application and see that HTTP/2 is transparently enabled. To see if everything is fine, we advise to check the session activity for your host by opening link:chrome://net-internals/#spdy in chrome.</p> </div> <div class="paragraph"> <p>Any WUIC <a href="https://github.com/wuic/wuic-samples">sample</a> can be run with HTTP/2. Read the <code>README.md</code> for details!</p> </div> </div> </div> </div> <div class="sect2"> <h3 id="_http_2_and_nghttpx">HTTP/2 and nghttpx</h3> <div class="paragraph"> <p>With <a href="https://nghttp2.org">nghttpx</a> installed as a proxy, WUIC can initiate a HTTP/2 <code>server-push</code> without any extra HTTP/2 installation in your java server!</p> </div> <div class="paragraph"> <p>This interesting and alternative technique is to let a <code>nghttpx</code> proxy to negotiate a HTTP/2 connection with browsers and initiate <code>server-push</code> according to the header specified in the HTTP response sent from the back-end. <code>nghttpx</code> pushes resources referenced in the <code>&lt;link&gt;</code> header found in the proxied HTTP response. See their documentation for more details <a href="https://nghttp2.org/documentation/nghttpx-howto.html">here</a>.</p> </div> <div class="paragraph"> <p>The good news is that WUIC specifies by default <code>&lt;link&gt;</code> headers in the HTTP response when a HTML page is filtered by the <code>com.github.wuic.servlet.HtmlParserFilter</code>. Consequently you just have to install this listener in your webapp without the need to configure HTTP/2 in your servlet container.</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_natural_templating_with_angularjs">Natural templating with AngularJS</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_purpose_3">Purpose</h3> <div class="paragraph"> <p>This part explain an important design consideration when you want to mix natural templating, WUIC and <code>AngularJS</code>. In fact, WUIC reads <code>templateUrl</code> option relatively to the script location declaring the directive, while in a pure HTML page, <code>AngularJS</code> loads it relatively to the page location. This chapter gives details about the workaround you can use to mix natural templating in development and server-side WUIC optimization in production.</p> </div> </div> <div class="sect2"> <h3 id="_design">Design</h3> <div class="paragraph"> <p>Natural templating considers you should not process your page on server side before it could be served to the client. WUIC makes it possible since you can write a pure HTML page and then optimize it with an <a href="http://wuic.github.io/apidocs/com/github/wuic/engine/core/HtmlInspectorEngine.html">engine</a> installed by default. The simplest way to optimize the page in this case is to use the <a href="tutorials.html#_use_the_servlet_filter">servlet filter</a> provided by WUIC.</p> </div> </div> <div class="sect2"> <h3 id="_demonstration">Demonstration</h3> <div class="paragraph"> <p>If you want to directly display the HTML page in the browser, your templates will be loaded relatively to this page. For instance, if we have the following structure:</p> </div> <div class="listingblock"> <div class="content"> <pre>    .
    |--app
       `-- index.html
       |--myFeature
          |--directive
             `-- myDirective.js
          |--template
             `-- myTemplate.html</pre> </div> </div> <div class="paragraph"> <p>You will write your directive like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">    myModule.directive('myDirective', function() {
       return {
           templateUrl: 'myFeature/template/myTemplate.html'
       };
    });</code></pre> </div> </div> <div class="paragraph"> <p>Everything will work fine. Then if you want to use the <a href="tutorials.html#_use_the_servlet_filter">servlet filter</a> provided by WUIC. When you deploy into production, WUIC will try to detect <code>templateUrl</code> options in the javascript code. In our example, WUIC will read the URL <code>myFeature/template/myTemplate.html</code> relatively to the script <code>myDirective.js</code>, which leads to bad URL computation (<code>/app/myFeature/myDirective/myFeature/template/myTemplate.html</code> does not exists!). In that case, WUIC will log a warning and won&#8217;t change the statement. Your application won&#8217;t be broken but no optimization will be done!</p> </div> <div class="paragraph"> <p>So if you want to see your template optimized, you should write your directive like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">    myModule.directive('myDirective', function() {
       return {
           templateUrl: '../template/myTemplate.html'
       };
    });</code></pre> </div> </div> <div class="paragraph"> <p>The problem is that your template won&#8217;t work when you display your page without filtering it with WUIC. In fact, because the URL is relative to the page location, the browser will try to load <code>/app/../template/myTemplate.html</code>, which does not exists! The solution is to provide a function which takes in parameter the relative URL and computes the correct absolute path like WUIC does. This could be done with a function returning the location of the current executed script. You can bind this function to the declared module:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">var myModule = angular.modue('myModule');

/**
 * Gets the directory path (url without file name) from the latest loaded script.
 * This function could be used to register script location when they get executed.
 * In fact the returned object exposes a getChild function which returns a given path
 * concatenated to the script directory path.
 *
 * @method getPathRelativeToScript
 * @returns {Object} the directory path
 */
myModule.getLastScriptPathDirectory = function () {
    var scripts = document.getElementsByTagName('script');
    var path = scripts[scripts.length - 1].src.split('?')[0]; // remove any ?query
    var dir = path.split('/').slice(0, -1).join('/') + '/';   // remove last filename part of path

    return {
        getChild : function(path) {
            return dir + path;
        }
    }
};</code></pre> </div> </div> <div class="paragraph"> <p>Then in your <code>myDirective.js</code> file, you can use this function like that:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">    1. myModule.constant('myDirectiveUrl', myModule.getLastScriptPathDirectory());
    2. myModule.directive('myDirective', function(myDirectiveUrl) {
    3.    var getChild = myDirectiveUrl.getChild;
          return {
    4.        templateUrl: getChild('../template/myTemplate.html')
          };
       });</code></pre> </div> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>We declare the AngularJS constant which to keep the script location.</p> </li> <li> <p>We inject the constant into the directive.</p> </li> <li> <p>The constant is an object providing a getChild function.</p> </li> <li> <p>We use the getChild function to get the correct absolute URL.</p> </li> </ol> </div> <div class="paragraph"> <p>The last thing we have to do is to configure WUIC to not extract <code>getChild(&#8230;&#8203;)</code> as an URL and instead ignore the wrapping function. This could be done by configuring the <code>JavascriptInspectorEngine</code> in your <code>wuic.xml</code> file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;wuic&gt;
    &lt;engine-builders&gt;
        &lt;engine-builder id="wuicDefaultJavascriptInspectorEngineBuilder" type="JavascriptInspectorEngineBuilder"&gt;
            &lt;properties&gt;
                &lt;property key="c.g.wuic.engine.wrapPattern"&gt;getChild(%s)&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/engine-builder&gt;
    &lt;/engine-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="paragraph"> <p>That&#8217;s it! you can now develop without any server deployment and then let WUIC optimize your scripts in production!</p> </div> <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script> <script type="text/javascript" src="/pages/3905848312/000000009ED4419Faggregate.js"></script> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-10-28 20:27:39 +01:00 </div> </div> </body> </html>