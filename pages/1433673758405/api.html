<!DOCTYPE html> <html manifest="/pages/1433673758405/api.html.appcache" lang="en"> <head><link rel="preload" href="/pages/2861444051/00000000DA6E17BBaggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1503751251/000000006B8EFF0Daggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1433673759808/bootstrap/css/a/../img/glyphicons-halflings.png" as="image" />
<link rel="preload" href="/pages/1433673759806/bootstrap/css/a/../img/glyphicons-halflings-white.png" as="image" />
<link rel="preload" href="/pages/1433673759867/wiki-css/a/../wiki-images/background.png" as="image" />
<link rel="preload" href="/pages/1433673759845/font-awesome/css/a/../font/fontawesome-webfont.eot" as="font" />
<link rel="preload" href="/pages/1433673759853/font-awesome/css/a/../font/fontawesome-webfont.woff" as="font" />
<link rel="preload" href="/pages/1433673759850/font-awesome/css/a/../font/fontawesome-webfont.ttf" as="font" />
<link rel="preload" href="/pages/1433673759869/000000006B8EFF0Dwiki-images/logo/favicon.ico" as="image" />
<link rel="preload" href="/pages/948598156/000000003EEFDD0Faggregate.js" as="script" />
 <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.2"> <title>Configuring the wuic.xml</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel="stylesheet" type="text/css" href="/pages/2861444051/00000000DA6E17BBaggregate.css" />
 </head> <body class="article toc2 toc-right"> <div id="header"> <div id="toc" class="toc2"> <div id="toctitle">Table of Contents</div> <ul class="sectlevel1"> <li><a href="#_configuring_the_wuic_xml">Configuring the wuic.xml</a> <ul class="sectlevel2"> <li><a href="#_wuic">wuic</a></li> <li><a href="#_nut_dao_builders">nut-dao-builders</a></li> <li><a href="#_nut_filter_builders">nut-filter-builders</a></li> <li><a href="#_engine_builders">engine-builders</a></li> <li><a href="#_heaps">heaps</a></li> <li><a href="#_workflow_templates">workflow-templates</a></li> <li><a href="#_workflows">workflows</a></li> </ul> </li> <li><a href="#_configuring_the_web_xml">Configuring the web.xml</a> <ul class="sectlevel2"> <li><a href="#_introduction">Introduction</a></li> <li><a href="#_configuring_the_contextlistener">Configuring the ContextListener</a></li> <li><a href="#_configuring_the_wuicservlet">Configuring the WuicServlet</a></li> <li><a href="#_configuring_the_htmlparserfilter">Configuring the HtmlParserFilter</a></li> </ul> </li> <li><a href="#_built_in_html_templating">Built-in HTML templating</a> <ul class="sectlevel2"> <li><a href="#_data_wuic_skip_don_t_optimize_the_script">data-wuic-skip: don&#8217;t optimize the script</a></li> <li><a href="#_wuic_html_import_import_workflow">wuic:html-import: import workflow</a></li> </ul> </li> <li><a href="#_java_config">Java Config</a> <ul class="sectlevel2"> <li><a href="#_purpose">Purpose</a></li> <li><a href="#_create_the_facade">Create the facade</a></li> <li><a href="#_configure_the_facade">Configure the facade</a></li> <li><a href="#_run_a_workflow">Run a workflow</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <link rel="stylesheet" type="text/css" href="/pages/1503751251/000000006B8EFF0Daggregate.css" />
<link rel="shortcut icon" href="/pages/1433673759869/000000006B8EFF0Dwiki-images/logo/favicon.ico" />
    <!--[if lt IE 9]><script src="../assets/js/html5shiv.js"></script><![endif]-->   <div class="masthead"> <div class="navbar"> <div class="navbar-inner"> <div class="container"> <ul class="nav" role="navigation"> <li><a href="index.html"><i class="icon-home"></i><span class="hidden-phone">&nbsp;Home</span></a></li> <li><a href="project.html"><i class="icon-star"></i><span class="hidden-phone">&nbsp;Project</span></a></li> <li class="active"><a href="documentation.html"><i class="icon-book"></i><span class="hidden-phone">&nbsp;Documentation</span></a></li> <li><a href="contact.html"><i class="icon-envelope"></i><span class="hidden-phone">&nbsp;Contact</span></a></li> <li><a href="https://github.com/wuic/wuic" target="_blank" title="Wuic Github"><i class="icon-github"></i><span class="hidden-phone">&nbsp;Github</span></a></li> <li><a href="https://twitter.com/wuic_project" target="_blank"><i class="icon-twitter"></i><span class="hidden-phone">&nbsp;Twitter</span></a></li> </ul> </div> </div> </div> </div> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <div class="title">Important</div> </td> <td class="content"> for deep understanding of settings purpose declared in <code>web.xml</code>, you should take a look at the <a href="design.htm">WUIC configuration design</a>. </td> </tr> </table> </div> <div class="sect1"> <h2 id="_configuring_the_wuic_xml">Configuring the wuic.xml</h2> <div class="sectionbody"> <div class="paragraph"> <p>The table bellow describes each tag and their hierarchy in the <code>wuic.xml</code> file :</p> </div> <table> <tr> <td>Root</td> <td>Level 0</td> <td>Level 1</td> <td>Level 2</td> <td>Level 3</td> </tr> <tr> <td><a href="#_wuic">wuic</a></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td>|____</td> <td><a href="#_nut-dao-builders">nut-dao-builders</a></td> <td></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td>|_________</td> <td><a href="#_nut-dao-builder">nut-dao-builder</a></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td>|_________</td> <td><a href="#_properties">properties</a></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td></td> <td>|_________</td> <td><a href="#_property">property</a></td> </tr> <tr> <td>|____</td> <td><a href="#_nut-filter-builders">nut-filter-builders</a></td> <td></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td>|_________</td> <td><a href="#_nut-filter-builder">nut-filter-builder</a></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td>|_________</td> <td><a href="#_properties">properties</a></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td></td> <td>|_________</td> <td><a href="#_property">property</a></td> </tr> <tr> <td>|____</td> <td><a href="#_heaps">heaps</a></td> <td></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td>|_________</td> <td><a href="#_heap">heap</a></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td>|_________</td> <td><a href="#_nut-path">nut-path</a></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td>|_________</td> <td><a href="#_heap-id">heap</a></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td>|_________</td> <td><a href="#_heap">heap-id</a></td> <td></td> </tr> <tr> <td>|____</td> <td><a href="#_engine-builders">engine-builders</a></td> <td></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td>|_________</td> <td><a href="#_engine-builder">engine-builder</a></td> <td></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td>|_________</td> <td><a href="#_properties">properties</a></td> <td></td> </tr> <tr> <td>|</td> <td></td> <td></td> <td>|_________</td> <td><a href="#_property">property</a></td> </tr> <tr> <td>|____</td> <td><a href="#_workflow-templates">workflow-templates</a></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td>|_________</td> <td><a href="#_workflow-template">workflow-template</a></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td>|_________</td> <td><a href="#_engine-chain">engine-chain</a></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td>|_________</td> <td><a href="#_engine-builder-id">engine-builder-id</a></td> </tr> <tr> <td>|____</td> <td><a href="#_workflows">workflows</a></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td>|_________</td> <td><a href="#_workflow">workflow</a></td> <td></td> <td></td> </tr> </table> <div class="sect2"> <h3 id="_wuic">wuic</h3> <div class="paragraph"> <p>This is simply the root tag, <a href="http://www.youtube.com/watch?v=x7bIbVlIqEc">nothing else matter</a> ;-)</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    ...
&lt;/wuic&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_nut_dao_builders">nut-dao-builders</h3> <div class="paragraph"> <p>The NutDao builders usable in the context. Each builder will be usable from the <a href="#heap">heap</a>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;nut-dao-builders&gt;
        ...
    &lt;/nut-dao-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="sect3"> <h4 id="_nut_dao_builder">nut-dao-builder</h4> <div class="paragraph"> <p>Each builder creates a <code>NutDao</code> thanks to a set of properties. When a factory is created, it is used to build NutDao thanks to a <code>String</code> representation of its path. Defines an unique ID to be referenced somewhere else. Also declares the class name as a <code>class</code> attribute.</p> </div> <div class="paragraph"> <p>Finally, an optional regex attribute could be specified (default value is false). If true, the nut names must be a compilable <a href="http://docs.oracle.com/javase/1.4.2/docs/api/java/util/regex/Pattern.html">pattern</a>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;nut-dao-builders&gt;
        &lt;nut-dao-builder id="http-resource-builder" type="HttpNutDaoBuilder"&gt;
            ...
        &lt;nut-dao-builder&gt;
    &lt;/nut-dao-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> <code>id</code> attribute is optional. If not set, the properties will be applied to the default instance of the <code>type</code>. </td> </tr> </table> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> <code>type</code> attribute is optional. The default value is <code>ClasspathNutDaoBuilder</code> (for classpath access). </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="_nut_filter_builders">nut-filter-builders</h3> <div class="paragraph"> <p>The NutFilter builders usable in the context. Each builder will be used inside the context</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;nut-filter-builders&gt;
        ...
    &lt;/nut-filter-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="sect3"> <h4 id="_nut_filter_builder">nut-filter-builder</h4> <div class="paragraph"> <p>Each builder creates a NutFiler thanks to a set of properties. Objects are built thanks to a String representation of its path. Defines an unique ID to be referenced somewhere else. Also declares the class name as a <code>class</code> attribute. When any <a href="#heap">heap</a> is built from the context, its paths are previously filtered with all defined filters.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;nut-filter-builders&gt;
        &lt;nut-filter-builder id="remove-regex-filter-builder" type="RegexRemoveNutFilterBuilder"&gt;
            ...
        &lt;nut-filter-builder&gt;
    &lt;/nut-filter-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> <code>id</code> attribute is optional. If not set, the properties will be applied to the default instance of the component indicated in the <code>type</code>. </td> </tr> </table> </div> </div> </div> <div class="sect2"> <h3 id="_engine_builders">engine-builders</h3> <div class="paragraph"> <p>Defines the engine builders usable in any workflow.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
   &lt;engine-builders&gt;
       ...
   &lt;/engine-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="sect3"> <h4 id="_engine_builder">engine-builder</h4> <div class="paragraph"> <p>An EngineBuilder is always identified by an unique ID to be referenced somewhere else. Also defines the class to be instantiated.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
   &lt;engine-builders&gt;
       &lt;engine-builder id="yuicomspressor-js" type="YuiCompressorJavascriptEngineBuilder" /&gt;
   &lt;/engine-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> <code>id</code> attribute is optional. If not set, the properties will be applied to the default instance of the component indicated in the <code>type</code>. Note that default instances are injected by default in any workflow. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="_properties">properties</h4> <div class="paragraph"> <p>The properties define a list of settings for both <code>nut-dao-builder</code> and <code>engine-builder</code> elements.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;nut-dao-builders&gt;
        &lt;nut-dao-builder id="http-resource-builder" type="HttpNutDaoBuilder"&gt;
            &lt;properties&gt;
                ...
            &lt;properties&gt;
        &lt;nut-dao-builder&gt;
    &lt;/nut-dao-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="paragraph"> <p>or</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;engine-builders&gt;
        &lt;engine-builder id="jsSprite" type="ImageAggregatorEngineBuilder"&gt;
            &lt;properties&gt;
                ...
            &lt;/properties&gt;
        &lt;/engine-builder&gt;
    &lt;/engine-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_property">property</h4> <div class="paragraph"> <p>A property used to initialize the builder. Defines a <code>key</code> attribute and a <code>value</code> as a child node.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;nut-dao-builders&gt;
        &lt;nut-dao-builder id="http-resource-builder" type="HttpNutDaoBuilder"&gt;
            &lt;properties&gt;
                &lt;property key="c.g.wuic.httpServerDomain"&gt;gdrouet.github.io&lt;/property&gt;
                &lt;property key="c.g.wuic.httpBasePath"&gt;wuic&lt;/property&gt;
            &lt;properties&gt;
        &lt;nut-dao-builder&gt;
    &lt;/nut-dao-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="paragraph"> <p>or</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;engine-builders&gt;
        &lt;engine-builder id="jsSprite" type="ImageAggregatorEngineBuilder"&gt;
            &lt;properties&gt;
                &lt;property key="c.g.wuic.engine.spriteProviderClassName"&gt;javascript&lt;/property&gt;
            &lt;/properties&gt;
        &lt;/engine-builder&gt;
    &lt;/engine-builders&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="_heaps">heaps</h3> <div class="paragraph"> <p>Defines the different heaps of nuts you can load in your application.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;heaps&gt;
        ...
    &lt;/heaps&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="sect3"> <h4 id="_heap">heap</h4> <div class="paragraph"> <p>A heap is identified by an unique ID and must defines a builder to use (<code>dao-builder-id attribute</code>). The builder is referenced thanks to its ID.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;heaps&gt;
        &lt;heap id="common-js" dao-builder-id="classPathBuilder"&gt;
            ...
        &lt;/heap&gt;
    &lt;/heaps&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> <code>dao-builder-id</code> is optional. By default, the default <code>ClasspathNutDaoBuilder</code> will be used. </td> </tr> </table> </div> </div> <div class="sect3"> <h4 id="_nut_path">nut-path</h4> <div class="paragraph"> <p>The <code>nut-path</code> defines the path that allows to access a nut has child node. Finally, you can represent a set of nuts if your associated DAO considers paths as regex.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;heaps&gt;
        &lt;heap id="common-js" default-builder="classPathBuilder"&gt;
            &lt;nut-path&gt;/js/common.js&lt;/nut-path&gt;
            &lt;nut-path&gt;/js/misc/*.js&lt;/nut-path&gt;
        &lt;/heap&gt;
    &lt;/heaps&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_heap_id">heap-id</h4> <div class="paragraph"> <p>Your heap could be a composition of another heaps. Inside a heap, you can refer an existing one with <code>heap-id</code> or declare a new heap on the fly.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;heaps&gt;
        &lt;heap id="homepage-js" dao-builder-id="classPathBuilder"&gt;
           &lt;heap-id&gt;common-js&lt;/heap-id&gt;
           &lt;heap id="homepage-js" dao-builder-id="http-resource-builder"&gt;
               &lt;nut-path&gt;http://com.myapp/js/foo.js&lt;/nut-path&gt;
           &lt;/heap&gt;
           &lt;nut-path&gt;js/bar.js&lt;/nut-path&gt;
        &lt;heap&gt;
    &lt;/heaps&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="_workflow_templates">workflow-templates</h3> <div class="paragraph"> <p>The workflow templates describe the way the nut could be processed.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;workflow-templates&gt;
           ...
    &lt;/workflow-templates&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="sect3"> <h4 id="_workflow_template">workflow-template</h4> <div class="paragraph"> <p>The workflow template is declared to contain a list of engines. It is identified with an unique ID.</p> </div> <div class="paragraph"> <p>Below, the example shows that a workflow template will be created and identified with <code>tpl</code> ID.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;workflow-templates&gt;
        &lt;workflow-template id="tpl"&gt;
            ...
        &lt;/workflow-template&gt;
    &lt;/workflow-templates&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_engine_chain">engine-chain</h4> <div class="paragraph"> <p>The engines chain will refers all the engines to use when processing the workflow. They could be specified in any order, WUIC will order them by kind, especially to guarantee that cache engine will be at the head of the chain.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;workflow-templates&gt;
        &lt;workflow-template id-prefix="js-image" heap-id-pattern="sprite-"&gt;
            &lt;engine-chain&gt;
                ...
            &lt;/engine-chain&gt;
        &lt;/workflow-template&gt;
    &lt;/workflow-templates&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_engine_builder_id">engine-builder-id</h4> <div class="paragraph"> <p>The engine-builder-id contains has child text node the ID of an existing engine builder to be added in the chain of responsibility executed by the workflow.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;workflow-templates&gt;
        &lt;workflow-template id-prefix="js-image" heap-id-pattern="sprite-"&gt;
            &lt;engine-chain&gt;
                &lt;engine-builder-id&gt;jsSprite&lt;/engine-builder-id&gt;
            &lt;/engine-chain&gt;
        &lt;/workflow-template&gt;
    &lt;/workflow-templates&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="_workflows">workflows</h3> <div class="paragraph"> <p>The workflows are the bridge between the heaps and the workflow template that list the engines to use.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;workflows&gt;
           ...
    &lt;/workflows&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="sect3"> <h4 id="_workflow">workflow</h4> <div class="paragraph"> <p>The workflow is declared to be applied on a set of heaps described with the <code>heap-id-pattern</code> property interpreted as a regex. Each heap&#8217;s name matching the regex will be associated to a workflow identified by the heap name and eventually a prefix specified in <code>id-prefix</code> property.</p> </div> <div class="paragraph"> <p>The workflow is always built on top of a template referenced with <code>workflow-template-id</code> property.</p> </div> <div class="paragraph"> <p>Below, the example shows that a workflow will be created for each heap with a name containing <code>image</code> word. Those workflows will be named with a string starting with <code>sprite-</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;workflows&gt;
        &lt;workflow id-prefix="sprite-" workflow-template-id="tpl" heap-id-pattern=".*image" /&gt;
    &lt;/workflows&gt;
&lt;/wuic&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Another possibility is to replace <code>id-prefix</code> attribute by an <code>id</code> attribute. In this case, only one workflow is created identified by the value in the <code>id</code> attribute. This workflow is associated to a heap which is a composition of all heaps with an ID matching the <code>heap-id-pattern</code> attribute regex value.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;wuic&gt;
    &lt;workflows&gt;
        &lt;workflow id="workflow" workflow-template-id="tpl" heap-id-pattern=".*image" /&gt;
    &lt;/workflows&gt;
&lt;/wuic&gt;</code></pre> </div> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_configuring_the_web_xml">Configuring the web.xml</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_introduction">Introduction</h3> <div class="paragraph"> <p>Basic use case is to use WUIC inside a servlet container configured traditionally with a <code>web.xml</code> file. This documentation described how to configure three main components:</p> </div> <div class="ulist"> <ul> <li> <p><code>WuicServletContextListener</code>: the listener that bootstraps WUIC</p> </li> <li> <p><code>HtmlParserFilter</code>: the filter that optimizes HTML pages</p> </li> <li> <p><code>WuicServlet</code>: the servlet that served the statics</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_configuring_the_contextlistener">Configuring the ContextListener</h3> <div class="paragraph"> <p><code>wuic-servlet.jar</code> contains a <code>ContextListener</code> annotated with the servlet 3 <code>@WebListener</code> annotation and allows WUIC to bootstrap.</p> </div> <div class="paragraph"> <p>You can configure the execution of the listener with the following <code>context-param</code>.</p> </div> <div class="paragraph"> <p>Reminder for default implementation:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;context-param&gt;
        &lt;param-name&gt;your param name&lt;/param-name&gt;
        &lt;param-value&gt;your param value&lt;/param-value&gt;
    &lt;/context-param&gt;</code></pre> </div> </div> <div class="paragraph"> <p><strong>Note those who don&#8217;t want use init-param:</strong> you will see the particular <code>c.g.wuic.initParameterClass</code> <code>init-param</code> in the table below. If you want to provide parameters in a different way, specify an implementation of <code>com.github.wuic.util.BiFunction</code> (inspired from Java 8). It must be parameterized with String type only. The first parameter of <code>apply()</code> expects the key and the second parameter the default value. The method returns the value associated to the given key. If you set this <code>init-param</code>, no other init-param with a key mentioned bellow will be interpreted since your implementation will be used.</p> </div> <div class="paragraph"> <p>In the <code>Parameter name</code> column bellow, replace the first <code>*</code> character from all keys and replace it with <code>c.g.wuic</code>.</p> </div> <table> <tr> <td>Parameter name</td> <td>Description</td> <td>Default value</td> </tr> <tr> <td>*.facade.wuicContextPath</td> <td>Virtual base path for any nut name</td> <td>Empty string</td> </tr> <tr> <td>*.facade.wuicXmlPath</td> <td>String used to build a `java.net.URL` expected to point to a `wuic.xml` file</td> <td>/wuic.xml in the classpath</td> </tr> <tr> <td>*.facade.wuicXmlPathAsSystemProperty</td> <td>Considers the `c.g.wuic.facade.wuicXmlPath` as a system property to get to build the URL</td> <td>false</td> </tr> <tr> <td>*.facade.propertiesPath</td> <td>String used to build a `java.net.URL` expected to point to a `wuic.properties` file</td> <td>/wuic.properties in the classpath</td> </tr> <tr> <td>*.facade.propertiesPathAsSystemProperty</td> <td>Considers the `c.g.wuic.facade.propertiesPath` as a system property to get to build the URL</td> <td>false</td> </tr> <tr> <td>*.facade.useDefaultContextBuilderConfigurators</td> <td>Injects in WUIC the default builders to have basic `NutDao` and `Engine` available during configuration</td> <td>true</td> </tr> <tr> <td>*.facade.wuicMultipleConfigInTagSupport</td> <td>For tag support (Thymeleaf, JSP, etc) : tell to parse the configuration every time the tag is run</td> <td>false</td> </tr> <tr> <td>*.facade.wuicWarmupStrategy</td> <td>When a context is built, a warmup strategy could be specified run all known workflows asynchronously (`ASYNC`), synchronously (`SYNC`) or not (`NONE`)</td> <td>NONE</td> </tr> <tr> <td>*.initParameterClass</td> <td>Indicates the com.github.wuic.util.BiFunction implementation which retrieves a value for a given parameter. Of course, default implementation relies on init-param in web.xml file.</td> <td>Internal InitParamProperties class</td> </tr> </table> </div> <div class="sect2"> <h3 id="_configuring_the_wuicservlet">Configuring the WuicServlet</h3> <div class="paragraph"> <p>If you want to serve directly the statics from your webapp, you need to configure the servlet:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;servlet&gt;
        &lt;description&gt;WUIC servlet&lt;/description&gt;
        &lt;servlet-name&gt;wuic&lt;/servlet-name&gt;
        &lt;servlet-class&gt;com.github.wuic.servlet.WuicServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;wuic&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/wuic/*&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_configuring_the_htmlparserfilter">Configuring the HtmlParserFilter</h3> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <div class="title">Warning</div> </td> <td class="content"> parsing the HTML takes time. You should enable the best effort mode: if the HTML has been parsed before and the result still exists in the cache, it applies replacements. However, it just return the unparsed HTML to deliver as fast as possible the response and process scripts asynchronously. TODO: migrate best effort and include filter section about that </td> </tr> </table> </div> <div class="sect3"> <h4 id="_install_the_filter">Install the filter</h4> <div class="paragraph"> <p>If your pages are served from your application server, you can filter them with the HTML filter:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;filter&gt;
    &lt;filter-name&gt;htmlParserFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;com.github.wuic.servlet.HtmlParserFilter&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;htmlParserFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/html/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_supported_settings">Supported settings</h4> <table> <tr> <td>Parameter name</td> <td>Description</td> <td>Default value</td> </tr> <tr> <td>c.g.wuic.filter.disableServerPush</td> <td>Never use HTTP/2 server-push even if possible and use server-hints instead</td> <td>false</td> </tr> <tr> <td>c.g.wuic.forceDynamicContent</td> <td>Always consider the filtered HTML as dynamic instead of checking if tag support (JSP or Thymeleaf) has been used to generate the response</td> <td>false</td> </tr> </table> <div class="paragraph"> <p>By default WUIC uses a <code>RequestDispatcherNutDao</code>. The <a href="http://wuic.github.io/apidocs/com/github/wuic/servlet/HtmlParserFilter.html">javadoc</a> describes how you can extend the filter to specify another DAO or even a complete chain of engines to use. Note that if you use <code>FilterRegistration</code> then you can instantiate the class with different constructors instead of using the default one.</p> </div> </div> <div class="sect3"> <h4 id="_complete_sample">Complete sample</h4> <div class="paragraph"> <p>You have the sample [here](<a href="https://github.com/wuic/wuic-samples/tree/wuic-0.5.x-snapshot/js-css-sample" class="bare">https://github.com/wuic/wuic-samples/tree/wuic-0.5.x-snapshot/js-css-sample</a>).</p> </div> <table> <tr> <td>Parameter name</td> <td>Description</td> <td>Default value</td> </tr> <tr> <td>c.g.wuic.filter.disableServerPush</td> <td>Never use HTTP/2 server-push even if possible and use server-hints instead</td> <td>false</td> </tr> <tr> <td>c.g.wuic.forceDynamicContent</td> <td>Always consider the filtered HTML as dynamic instead of checking if tag support (JSP or Thymeleaf) has been used to generate the response</td> <td>false</td> </tr> </table> </div> </div> </div> </div> <div class="sect1"> <h2 id="_built_in_html_templating">Built-in HTML templating</h2> <div class="sectionbody"> <div class="paragraph"> <p>Built-in templating is a set of features that you can use when your HTML content is optimized by WUIC (using the servlet <code>Filter</code> or by declaring it in a <code>heap</code>).</p> </div> <div class="paragraph"> <p>When WUIC optimizes HTML content, it uses by default the <code>HtmlInspectorEngine</code> component that supports several tags and attributes to customize the way your HTML template is optimized.</p> </div> <div class="sect2"> <h3 id="_data_wuic_skip_don_t_optimize_the_script">data-wuic-skip: don&#8217;t optimize the script</h3> <div class="paragraph"> <p>If you want WUIC skips files referenced by the HTML file, you can use the <code>data-wuic-skip</code> in the tag. This is useful if you don&#8217;t want to aggregate a particular resource for some reason. Moreover you can use it when WUIC does not already supports some features or you find a bug :) (don&#8217;t forget to file an issue in that case).</p> </div> <div class="paragraph"> <p>Example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">&lt;script data-wuic-skip src="script-to-skip.js"&gt;&lt;/script&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_wuic_html_import_import_workflow">wuic:html-import: import workflow</h3> <div class="paragraph"> <p>Any declared <code>workflow</code> can be executed to inject the result in your HTML page just by adding <code>&lt;wuic:html-import /&gt;</code> tag with the desired ID associated to the attribute <code>workflowId</code>.</p> </div> <div class="paragraph"> <p>Example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">&lt;wuic:html-import workflowId="myWorkflow" /&gt;</code></pre> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_java_config">Java Config</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_purpose">Purpose</h3> <div class="paragraph"> <p>WUIC could be integrated without necessarily use the XML configuration API. All XML configuration points are directly provided by a <code>Java</code> API which could be preferred in several use cases, especially for frameworks that want integrate WUIC.</p> </div> <div class="paragraph"> <p><strong>Note:</strong> for deep understanding of <code>Java</code> Config purpose, you should take a look at the <a href="design.html#_configuration_structure">WUIC configuration structure</a>.</p> </div> </div> <div class="sect2"> <h3 id="_create_the_facade">Create the facade</h3> <div class="paragraph"> <p>WUIC provides its <a href="http://wuic.github.io/apidocs/com/github/wuic/WuicFacade.html">facade</a> which helps to invoke workflow and configure mainly:</p> </div> <div class="ulist"> <ul> <li> <p>DAOs (the way you access nuts)</p> </li> <li> <p>Heaps (the sets of nuts)</p> </li> <li> <p>Engines (the different transformations applied on nuts)</p> </li> <li> <p>The chains (the engines called to process the heaps)</p> </li> </ul> </div> <div class="paragraph"> <p>You can create a new facade like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">        try {
            final WuicFacade facade = new WuicFacadeBuilder().contextPath("/statics").build();
        } catch (WuicException e) {
            log.error("Unable to build the facade.", e);
        }</code></pre> </div> </div> <div class="paragraph"> <p>We indicate the processed nuts will be served on your HTTP server from <code>/statics</code>. Here all the URLs will be rewritten using this prefix during process (like <code>background-url</code> inside CSS). This means that the result of any process must be reached from this root path (<a href="http://localhost/statics" class="bare">http://localhost/statics</a> for instance).</p> </div> <div class="paragraph"> <p>By default the facade injects DAOs and engines with default settings to make your configuration faster. This could be disabled with:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">        try {
            final WuicFacade facade = new WuicFacadeBuilder()
                    .noDefaultContextBuilderConfigurator()
                    .build();
        } catch (WuicException e) {
            log.error("Unable to build the facade.", e);
        }</code></pre> </div> </div> <div class="paragraph"> <p>Check the javadoc to see other configurations points exposed by the <a href="http://wuic.github.io/apidocs/com/github/wuic/WuicFacadeBuilder.html">WuicFacadeBuilder</a>.</p> </div> <div class="paragraph"> <p>Default instances are created for all DAOs / Engine discovered in the classpath by WUIC. They are identified by <code>wuicDefault[SimpleClassName][Builder]</code>, for instance <code>wuicDefaultTextAggregatorEngineBuilder</code> for the default instance of <code>TextAggregatorEngine</code>:</p> </div> <div class="ulist"> <ul> <li> <p>See <a href="http://wuic.github.io/apidocs/com/github/wuic/nut/dao/core/package-summary.html">this package</a> for DAOs</p> </li> <li> <p>See <a href="http://wuic.github.io/apidocs/com/github/wuic/engine/core/package-summary.html">this package</a> for engines</p> </li> <li> <p>See <a href="http://wuic.github.io/apidocs/com/github/wuic/nut/filter/core/package-summary.html">this package</a> for filters</p> </li> </ul> </div> <div class="paragraph"> <p>For default properties:</p> </div> <div class="ulist"> <ul> <li> <p>See this page (TODO: migrate <a href="https://github.com/wuic/wuic/wiki/Data-Access-Object" class="bare">https://github.com/wuic/wuic/wiki/Data-Access-Object</a>) for DAOs</p> </li> <li> <p>See this page (TODO: migrate <a href="https://github.com/wuic/wuic/wiki/Engine-configuration" class="bare">https://github.com/wuic/wuic/wiki/Engine-configuration</a>) for engines</p> </li> </ul> </div> <div class="paragraph"> <p>Additional DAOs and Engine will be available regarding the extensions you add to your classpath.</p> </div> </div> <div class="sect2"> <h3 id="_configure_the_facade">Configure the facade</h3> <div class="paragraph"> <p>To configure the facade, you can extend <a href="http://wuic.github.io/apidocs/index.html?com/github/wuic/ContextBuilderConfigurator.html">ContextBuilderConfigurator</a> and implement its two abstract methods:</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://wuic.github.io/apidocs/com/github/wuic/context/ContextBuilder.html#tag(java.lang.Object)">getTag()</a>: identifies all the settings you perform in your class. This helps WUIC to keep them when other configurators want to reset their previous operations.</p> </li> <li> <p><a href="http://wuic.github.io/apidocs/com/github/wuic/context/ContextBuilderConfigurator.html#internalConfigure(com.github.wuic.ContextBuilder)">internalConfigure(ContextBuilder)</a>: the <a href="http://gdrouet.github.io/wuic/apidocs/index.html?com/github/wuic/ContextBuilder.html">ContextBuilder</a> used inside the facade where you can define everything you need.</p> </li> </ul> </div> <div class="paragraph"> <p>For instance, use can access the <code>WuicFacadeBuilder</code> internal <code>ContextBuilder</code> and modify it like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">        final WuicFacadeBuilder builder =  new WuicFacadeBuilder();
        final String engineId = ContextBuilder.getDefaultBuilderId(TextAggregatorEngine.class);
        final String daoId = ContextBuilder.getDefaultBuilderId(DiskNutDao.class);

        try {
            final WuicFacade facade = builder.noDefaultContextBuilderConfigurator()
                    .contextBuilder()
                    // tag the configuration, always release the tag in a finally block to not face deadlock issue
                    .tag("custom")
                    // create a ContextNutDaoBuilder which produces DAO of type DiskNutDao
                    .contextNutDaoBuilder(DiskNutDao.class)
                    // override default property by telling that any path specified is relative to /static
                    .property("c.g.wuic.dao.basePath", "/statics")
                    // back to ContextBuilder
                    .toContext()
                    // create a heap using "daoId" with two nuts "darth.js" and "vader.js"
                    .heap("heap", daoId, new String[] { "dark.js", "vador.js"} )
                    // create a ContextEngineBuilder which produces engine of type TextAggregatorEngine
                    .contextEngineBuilder(TextAggregatorEngine.class)
                    // back to ContextBuilder
                    .toContext()
                    // creates a template "tpl" that describes a process that call the engine
                    .template("tpl", new String[]{ engineId })
                    // creates a workflow "starwarsWorkflow" with heap "heap" and the process described by "tpl"
                    .workflow("starwarsWorkflow", true, "heap", "tpl")
                    // release the tag before build
                    .releaseTag()
                    // back to FacadeBuilder
                    .toFacade()
                    // Build facade
                    .build();
        } catch (IOException ioe) {
            log.error("Unable to build the facade.", ioe);
        } catch (WuicException e) {
            log.error("Unable to build the facade.", e);
        } finally {
            builder.contextBuilder().releaseTag();
        }</code></pre> </div> </div> <div class="paragraph"> <p>Alternatively, you can create your own implementation of a <code>ContextBuilderConfigurator</code> to configure the <code>ContextBuilder</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    public class MyContextBuilderConfigurator extends ContextBuilderConfigurator {

        @Override
        public int internalConfigure(final ContextBuilder ctxBuilder) {
            // ...
            return -1;
        }

        @Override
        public String getTag() {
            return "myCfg";
        }

        @Override
        public ProcessContext getProcessContext() {
            return ProcessContext.DEFAULT;
        }

        @Override
        protected Long getLastUpdateTimestampFor(final String path) throws IOException {
            return -1L;
        }
    }</code></pre> </div> </div> <div class="paragraph"> <p>You can inject an instance in your facade like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">        try {
            final WuicFacade facade = new WuicFacadeBuilder().contextBuilderConfigurators(new MyContextBuilderConfigurator()).build();
        } catch (WuicException e) {
            log.error("Unable to build the facade.", e);
        }</code></pre> </div> </div> <div class="paragraph"> <p>Note that you can also force a facade to be refreshed with a <code>ContextBuilderConfigurator</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">        try {
            facade.configure(new MyContextBuilderConfigurator());
        } catch (WuicException e) {
            log.error("Unable to build the facade.", e);
        }</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_run_a_workflow">Run a workflow</h3> <div class="paragraph"> <p>Finally, when your facade has been configured, you can then run any created workflow like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">        try {
            // Contains one nut
            final List&lt;ConvertibleNut&gt; nut = facade.runWorkflow("starwarsWorkflow", ProcessContext.DEFAULT);

            nut.get(0).getName();    // aggregate.js
            nut.get(0).openStream(); // InputStream
        } catch (WuicException e) {
            log.error("Unable to build the facade.", e);
        } catch (IOException ioe) {
            log.error("Unable to build the facade.", ioe);
        }</code></pre> </div> </div> <div class="paragraph"> <p>Note that the facade is thread safe so you can use it with concurrency.</p> </div> <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script> <script type="text/javascript" src="/pages/948598156/000000003EEFDD0Faggregate.js"></script>
  </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-06-07 09:38:53 +01:00 </div> </div> </body> </html>