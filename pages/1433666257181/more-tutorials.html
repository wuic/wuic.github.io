<!DOCTYPE html> <html manifest="/pages/1433666257181/more-tutorials.html.appcache" lang="en"> <head><link rel="preload" href="/pages/2861444051/0000000069653BE2aggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1723211243/000000006B8EFF0Daggregate.css" as="stylesheet" />
<link rel="preload" href="/pages/1433666257571/bootstrap/css/a/../img/glyphicons-halflings.png" as="image" />
<link rel="preload" href="/pages/1433666257569/bootstrap/css/a/../img/glyphicons-halflings-white.png" as="image" />
<link rel="preload" href="/pages/1433666257624/wiki-css/a/../wiki-images/background.png" as="image" />
<link rel="preload" href="/pages/1433666257603/font-awesome/css/a/../font/fontawesome-webfont.eot" as="font" />
<link rel="preload" href="/pages/1433666257612/font-awesome/css/a/../font/fontawesome-webfont.woff" as="font" />
<link rel="preload" href="/pages/1433666257609/font-awesome/css/a/../font/fontawesome-webfont.ttf" as="font" />
<link rel="preload" href="/pages/1433666257633/000000006B8EFF0Dwiki-images/logo/favicon.ico" as="image" />
<link rel="preload" href="/pages/1249501647/000000001194B43Faggregate.js" as="script" />
 <meta charset="UTF-8"> <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]--> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="generator" content="Asciidoctor 1.5.2"> <title>Spring integration</title> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400"> <link rel="stylesheet" type="text/css" href="/pages/2861444051/0000000069653BE2aggregate.css" />
 </head> <body class="article toc2 toc-right"> <div id="header"> <div id="toc" class="toc2"> <div id="toctitle">More 5 minutes tutorials</div> <ul class="sectlevel1"> <li><a href="#_spring_integration">Spring integration</a> <ul class="sectlevel2"> <li><a href="#_spring_resource_handling">Spring resource handling</a></li> <li><a href="#_maven_dependency">Maven dependency</a></li> <li><a href="#_integrate_wuic_resolvers">Integrate WUIC resolvers</a></li> </ul> </li> <li><a href="#_angularjs">AngularJS</a> <ul class="sectlevel2"> <li><a href="#_feature">Feature</a></li> <li><a href="#_writing_your_directives">Writing your directives</a></li> <li><a href="#_inlining">Inlining</a></li> <li><a href="#_best_effort">Best effort</a></li> <li><a href="#_natural_templating">Natural Templating</a></li> </ul> </li> <li><a href="#_typescript_integration">Typescript integration</a> <ul class="sectlevel2"> <li><a href="#_the_tsc_command">The tsc command</a></li> <li><a href="#_configuration">Configuration</a></li> <li><a href="#_crossplatform_configuration">Crossplatform configuration</a></li> <li><a href="#_tsc_command_line_execution">tsc command line execution</a></li> </ul> </li> <li><a href="#_enable_http_2">Enable HTTP/2</a> <ul class="sectlevel2"> <li><a href="#_purpose">Purpose</a></li> <li><a href="#_java_server">Java server</a></li> <li><a href="#_http_2_and_nghttpx">HTTP/2 and nghttpx</a></li> </ul> </li> </ul> </div> </div> <div id="content"> <link rel="stylesheet" type="text/css" href="/pages/1723211243/000000006B8EFF0Daggregate.css" />
<link rel="shortcut icon" href="/pages/1433666257633/000000006B8EFF0Dwiki-images/logo/favicon.ico" />
    <!--[if lt IE 9]><script src="../assets/js/html5shiv.js"></script><![endif]-->   <div class="masthead"> <div class="navbar"> <div class="navbar-inner"> <div class="container"> <ul class="nav" role="navigation"> <li><a href="index.html"><i class="icon-home"></i><span class="hidden-phone">&nbsp;Home</span></a></li> <li><a href="project.html"><i class="icon-star"></i><span class="hidden-phone">&nbsp;Project</span></a></li> <li class="active"><a href="documentation.html"><i class="icon-book"></i><span class="hidden-phone">&nbsp;Documentation</span></a></li> <li><a href="contact.html"><i class="icon-envelope"></i><span class="hidden-phone">&nbsp;Contact</span></a></li> <li><a href="https://github.com/wuic/wuic" target="_blank" title="Wuic Github"><i class="icon-github"></i><span class="hidden-phone">&nbsp;Github</span></a></li> <li><a href="https://twitter.com/wuic_project" target="_blank"><i class="icon-twitter"></i><span class="hidden-phone">&nbsp;Twitter</span></a></li> </ul> </div> </div> </div> </div> <div class="sect1"> <h2 id="_spring_integration">Spring integration</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_spring_resource_handling">Spring resource handling</h3> <div class="paragraph"> <p><code>Spring</code> 4.1 exposes a <a href="http://spring.io/blog/2014/07/24/spring-framework-4-1-handling-static-web-resources">pluggable API</a> allowing to specify custom web resources resolution and transformation. WUIC provides an extension that comes with:</p> </div> <div class="ulist"> <ul> <li> <p>a <a href="http://docs.spring.io/spring-framework/docs/4.1.0.RC2/javadoc-api/org/springframework/web/servlet/resource/PathResourceResolver.html">PathResourceResolver</a> that process your workflow and wraps the resulting nut in a spring resource.</p> </li> <li> <p>a <a href="http://docs.spring.io/spring-framework/docs/4.1.0.RC2/javadoc-api/org/springframework/web/servlet/resource/VersionStrategy.html">VersionStrategy</a> to build public URLs with WUIC which includes in the URL a CRC32 content based hash or the last-modified timestamp regarding your <a href="https://github.com/wuic/wuic/wiki/Data-Access-Object">DAO configuration</a></p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_maven_dependency">Maven dependency</h3> <div class="paragraph"> <p>First you need to add to your <code>pom.xml</code> the maven dependency:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;dependency&gt;
        &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
        &lt;artifactId&gt;wuic-spring&lt;/artifactId&gt;
        &lt;version&gt;${wuic.version}&lt;/version&gt;
    &lt;/dependency&gt;</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_integrate_wuic_resolvers">Integrate WUIC resolvers</h3> <div class="paragraph"> <p><code>Spring</code> offers an easy way to configure resource handling with Java Config.</p> </div> <div class="paragraph"> <p>First, declare your <code>@Configuration</code> class as usual.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Configuration
    @EnableWebMvc
    public class MyWebConfig extends WebMvcConfigurerAdapter {

    }</code></pre> </div> </div> <div class="paragraph"> <p>Then create the <code>WuicFacade</code> to expose it as a bean in the <code>ApplicationContext</code>.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Autowired
    private ApplicationContext applicationContext;

    @Bean
    public WuicFacade wuicFacade() throws WuicException {
        return new WuicFacadeBuilder()
                .contextPath("/resources/")
                .wuicXmlPath(getClass().getResource("/wuic.xml"))
                .build();
    }</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> you can completely ignore the use of <code>wuic.xml</code> and configure WUIC with <a href="api.html#_java_config">Java Config</a>. </td> </tr> </table> </div> <div class="paragraph"> <p>Finally, just use the handy <code>WuicHandlerMapping</code> to inject to spring a bean handling resources with WUIC. Core resolvers are <code>WuicPathResourceResolver</code> and <code>WuicVersionStrategy</code>, but you can create additional implementations.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    @Bean
    public SimpleUrlHandlerMapping handleWuicResources(final ServletContext servletContext,
                                                       final ResourceUrlProvider resourceUrlProvider,
                                                       final WuicFacade wuicFacade) {
        final ResourceResolver versionResourceResolver =
                new VersionResourceResolver().addVersionStrategy(new WuicVersionStrategy(), "/**/*");

        final ResourceResolver pathResourceResolver =
                new WuicPathResourceResolver(applicationContext.getBean(WuicFacade.class));

        return new WuicHandlerMapping(applicationContext,
                servletContext,
                resourceUrlProvider,
                wuicFacade,
                Arrays.asList(versionResourceResolver, pathResourceResolver),
                Collections.&lt;ResourceTransformer&gt;emptyList());
    }</code></pre> </div> </div> <div class="paragraph"> <p>You can also override <code>addResourceHandlers</code> method to configure resolvers/transformers outside WUIC.</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-java" data-lang="java">    public void addResourceHandlers(final ResourceHandlerRegistry registry) {
        final ResourceResolver myResolver = new MyResourceResolver();
        registry.addResourceHandler("/other/**")
                .resourceChain(true)
                .addResolver(myResolver);
    }</code></pre> </div> </div> <div class="sect3"> <h4 id="_full_example">Full example</h4> <div class="paragraph"> <p>A full example is available <a href="https://github.com/wuic/wuic-samples/tree/wuic-0.5.x-snapshot/spring-sample">here</a>. In addition, it shows how you can mix built-in spring resolvers with WUIC and how to handle public URLs with <code>Thymeleaf</code>.</p> </div> </div> </div> </div> </div> <div class="sect1"> <h2 id="_angularjs">AngularJS</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_feature">Feature</h3> <div class="paragraph"> <p>WUIC provides out of the box an <code>AngularJS</code> support and optimize the <code>templateUrl</code> option by default! This topic gives you the details.</p> </div> </div> <div class="sect2"> <h3 id="_writing_your_directives">Writing your directives</h3> <div class="paragraph"> <p>AngularJS is MV* framework which advises the use of custom directives. As described in <a href="https://docs.angularjs.org/guide/directive">the documentation</a>:</p> </div> <div class="paragraph"> <p>Best Practice: Unless your template is very small, it&#8217;s typically better to break it apart into its own HTML file and load it with the <code>templateUrl</code> option.</p> </div> <div class="paragraph"> <p>This means that when <code>AngularJS</code> will instantiate the directive, an additional HTTP request will be executed to load the template content. This leads to two issues:</p> </div> <div class="ulist"> <ul> <li> <p>the user must waits the HTTP request is done to see the content displayed</p> </li> <li> <p>you should take care of client cache, which must be burst each time you deploy a new version with a different template</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_inlining">Inlining</h3> <div class="paragraph"> <p>WUIC takes care of templateUrl occurrences in javascript code and replace it with a template option.</p> </div> <div class="paragraph"> <p>For example, imagine you have the following directory tree:</p> </div> <div class="listingblock"> <div class="content"> <pre>    .
    |--app
       |--myFeature
          |--directive
             `-- myDirective.js
          |--template
             `-- myTemplate.html</pre> </div> </div> <div class="paragraph"> <p><code>myTemplate.html</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">    &lt;h1&gt;My Template  Title&lt;/h1&gt;</code></pre> </div> </div> <div class="paragraph"> <p>In your <code>myDirective.js</code> file, you can refer myTemplate.html with an URL relative to your script location:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">    myModule.directive('myDirective', function() {
       return {
           templateUrl: '../template/myTemplate.html'
       };
    });</code></pre> </div> </div> <div class="paragraph"> <p>When WUIC parses <code>myTemplate.js</code>, you will obtain something like that:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-javascript" data-lang="javascript">    myModule.directive('myDirective', function() {
       return {
           template: '&lt;h1&gt;My Template  Title&lt;/h1&gt;'
       };
    });</code></pre> </div> </div> <div class="paragraph"> <p>WUIC solves two issues:</p> </div> <div class="ulist"> <ul> <li> <p>You save the additional HTTP request</p> </li> <li> <p>As each file processed by WUIC is served with a different URL each time the content change, you make sure the client cache is burst when you update the template</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_best_effort">Best effort</h3> <div class="paragraph"> <p>Note that in best effort mode, WUIC serves the content as fast as possible and just rewrite the template URL, without running inlining process.</p> </div> </div> <div class="sect2"> <h3 id="_natural_templating">Natural Templating</h3> <div class="paragraph"> <p>If you want to mix natural templating and WUIC&#8217;s <code>AngularJS</code> optimization feature, you must read this important page (TODO: migrate <a href="https://github.com/wuic/wuic/wiki/Natural-Templating-with-AngularJS" class="bare">https://github.com/wuic/wuic/wiki/Natural-Templating-with-AngularJS</a>).</p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_typescript_integration">Typescript integration</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_the_tsc_command">The tsc command</h3> <div class="paragraph"> <p><code>Typescript</code> could be installed in several ways. If you are a <code>Node.JS</code> user, then you will be able to compile your source files with the 'tsc' command:</p> </div> <div class="listingblock"> <div class="content"> <pre>Examples: tsc hello.ts
          tsc --out file.js file.ts
          tsc @args.txt</pre> </div> </div> <div class="paragraph"> <p>Many options are available, like specifying the ECMAScript version or the sourcemap generation.</p> </div> <div class="paragraph"> <p>WUIC comes with an extension which is able to compile typescript files. The extension works in two modes:</p> </div> <div class="ulist"> <ul> <li> <p>executing the tsc command, which is faster but requires to install the module with Node.JS</p> </li> <li> <p>executing a compiler wrapper on top of rhino, which is slower but crossplatform</p> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_configuration">Configuration</h3> <div class="paragraph"> <p>First of all, you need to add the dependency to your project:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;wuic-typescript&lt;/artifactId&gt;
    &lt;version&gt;${wuic.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Then, you can write your HTML page by referencing your scripts:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">&lt;script src="greeter.ts"&gt;&lt;/script&gt;
&lt;script src="use.greeter.ts"&gt;&lt;/script&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Then you can just include the HTML page in the WUIC process, for instance by declaring it in your <code>wuic.xml</code> (TODO: migrate <a href="https://github.com/wuic/wuic/wiki/Understanding-wuic.xml" class="bare">https://github.com/wuic/wuic/wiki/Understanding-wuic.xml</a>) file or just filtering it with the servlet filter (TODO: migrate <a href="https://github.com/wuic/wuic/wiki/filter-html" class="bare">https://github.com/wuic/wuic/wiki/filter-html</a>).</p> </div> <div class="paragraph"> <p>When WUIC transforms the HTML page, it replaces the initial referenced typescript file by the compiled javascript file:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-html" data-lang="html">&lt;script src="/wuic/56321344/myWorkflow/aggregate.ts.js"&gt;&lt;/script&gt;</code></pre> </div> </div> <div class="paragraph"> <p>WUIC also serves a sourcemap file referenced in the compiled javascript.</p> </div> </div> <div class="sect2"> <h3 id="_crossplatform_configuration">Crossplatform configuration</h3> <div class="paragraph"> <p>By default, you don&#8217;t need to install Node.JS to compile your typescript source files with WUIC. The extension takes advantage from the <a href="https://www.npmjs.com/package/typescript-compiler">tsc wrapper project</a>, which is run with <a href="https://github.com/apigee/trireme">trireme</a>, a <code>Node.JS</code> compatibility layer for the JVM.</p> </div> <div class="paragraph"> <p>However, because trireme uses <code>Rhino</code> to executes javascript code, the compilation is slow, even with the optimizations provided by the project. This is not really a problem because compilation is performed at build time or when the server starts at runtime, but in development you need to compile each time you change your sources. In this case you might need to enable command line execution.</p> </div> </div> <div class="sect2"> <h3 id="_tsc_command_line_execution">tsc command line execution</h3> <div class="paragraph"> <p>The tsc command line compiles your sources 10x faster than rhino-based compiler and could be very useful when you need to recompile your scripts in development.</p> </div> <div class="paragraph"> <p>Before switching to this mode, you need to install the typescript compiler:</p> </div> <div class="listingblock"> <div class="content"> <pre>npm install -g typescript</pre> </div> </div> <div class="paragraph"> <p>Then, just set the <code>c.g.wuic.engine.useNodeJs</code> setting to true in the <code>TypescriptConverterEngineBuilder</code>. For instance, if you configure engines in your <code>wuic.xml</code>, you will write this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;engine-builders&gt;
    &lt;engine-builder type="TypescriptConverterEngineBuilder"&gt;
        &lt;properties&gt;
            &lt;property key="c.g.wuic.engine.useNodeJs"&gt;true&lt;/property&gt;
        &lt;/properties&gt;
    &lt;/engine-builder&gt;
&lt;/engine-builders&gt;</code></pre> </div> </div> <div class="paragraph"> <p>Note: you can filter the value with maven to set this setting to true only in a development profile. When you&#8217;ll go in production, the setting will be false and you won&#8217;t need to ask your ops to install <code>Node.JS</code></p> </div> </div> </div> </div> <div class="sect1"> <h2 id="_enable_http_2">Enable HTTP/2</h2> <div class="sectionbody"> <div class="sect2"> <h3 id="_purpose">Purpose</h3> <div class="paragraph"> <p>This tutorial shows how you can enable HTTP/2 in your server to let WUIC use this protocol.</p> </div> <div class="paragraph"> <p>HTTP/2 protocol specifies the <code>server-push</code> feature that allows to send over the HTTP response additional resources that the client should require one he fetched the response. For instance, if a browser fetches a HTML content, it will load additional resources like CSS or Javascript files. Actually, we don&#8217;t wait the browser performs a new request and we push those resources earlier.</p> </div> <div class="paragraph"> <p>This method is speculative because we don&#8217;t know that the client will really load the resource. For instance, if the resource is in the browser cache, then the <code>push</code> will be canceled.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <div class="title">Tip</div> </td> <td class="content"> by default, WUIC uses <a href="https://w3c.github.io/resource-hints">resource-hints</a> to let the browser fetch the resources once the HTTP response is sent to the client. This is slower than HTTP/2 <code>server-push</code> but not speculative: if the resource is in the browser cache no unnecessary download will occur. If you enable HTTP/2, then <code>server-push</code> will be used instead of <code>resource-hints</code>. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_java_server">Java server</h3> <div class="paragraph"> <p>Java server and even servlet containers don&#8217;t implement any standard API for HTTP/2. This means that each server comes with its own API that you need to specifically implement. WUIC hides those API and comes with a support for a specific server under the form of a JAR file.</p> </div> <div class="sect3"> <h4 id="_servlet_containers">Servlet containers</h4> <div class="paragraph"> <p>For any servlet container, you must install the <code>com.github.wuic.servlet.HtmlParserFilter</code> to let <code>WUIC</code> initiate a <code>server-push</code> for resources associated to the filtered HTML page.</p> </div> <div class="sect4"> <h5 id="_jetty">Jetty</h5> <div class="paragraph"> <p>First you need to install HTTP/2 with <code>Jetty</code>. This requires the version 9.3+ and the JDK 8. You will find a complete sample in this <a href="https://github.com/wuic/wuic-samples/blob/wuic-0.5.x-snapshot/pom.xml">pom.xml</a>.</p> </div> <div class="paragraph"> <p>Then, you just need to add the dependency corresponding to the <code>Jetty</code> support for WUIC:</p> </div> <div class="listingblock"> <div class="content"> <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;com.github.wuic.extensions&lt;/groupId&gt;
    &lt;artifactId&gt;http2-jetty&lt;/artifactId&gt;
    &lt;version&gt;${project.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre> </div> </div> <div class="paragraph"> <p>You can run your application and see that HTTP/2 is transparently enabled. To see if everything is fine, we advise to check the session activity for your host by opening link:chrome://net-internals/#spdy in chrome.</p> </div> <div class="paragraph"> <p>Any WUIC <a href="https://github.com/wuic/wuic-samples">sample</a> can be run with HTTP/2. Read the <code>README.md</code> for details!</p> </div> </div> </div> </div> <div class="sect2"> <h3 id="_http_2_and_nghttpx">HTTP/2 and nghttpx</h3> <div class="paragraph"> <p>With <a href="https://nghttp2.org">nghttpx</a> installed as a proxy, WUIC can initiate a HTTP/2 <code>server-push</code> without any extra HTTP/2 installation in your java server!</p> </div> <div class="paragraph"> <p>This interesting and alternative technique is to let a <code>nghttpx</code> proxy to negotiate a HTTP/2 connection with browsers and initiate <code>server-push</code> according to the header specified in the HTTP response sent from the back-end. <code>nghttpx</code> pushes resources referenced in the <code>&lt;link&gt;</code> header found in the proxied HTTP response. See their documentation for more details <a href="https://nghttp2.org/documentation/nghttpx-howto.html">here</a>.</p> </div> <div class="paragraph"> <p>The good news is that WUIC specifies by default <code>&lt;link&gt;</code> headers in the HTTP response when a HTML page is filtered by the <code>com.github.wuic.servlet.HtmlParserFilter</code>. Consequently you just have to install this listener in your webapp without the need to configure HTTP/2 in your servlet container.</p> </div> <script src="http://code.jquery.com/jquery-1.10.0.min.js"></script> <script type="text/javascript" src="/pages/1249501647/000000001194B43Faggregate.js"></script>
  </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-06-07 09:34:51 +01:00 </div> </div> </body> </html>